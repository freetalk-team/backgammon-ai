!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.Backgammon=r():e.Backgammon=r()}(self,(()=>(()=>{var e={288:()=>{Object.clone=function(e){var r=e instanceof Array?[]:{};for(let n in e)e[n]&&"object"==typeof e[n]?r[n]=ArrayBuffer.isView(e[n])?new e[n].constructor(e[n]):Object.clone(e[n]):r[n]=e[n];return r},Array.repeat=function(e,r=0){return new Array(e).fill(0)},String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)}}},r={};function n(t){var a=r[t];if(void 0!==a)return a.exports;var o=r[t]={exports:{}};return e[t](o,o.exports,n),o.exports}n.d=(e,r)=>{for(var t in r)n.o(r,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},n.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r);var t={};return(()=>{"use strict";n.d(t,{default:()=>$n}),n(288);class e{#e=!1;get name(){return"app"}get version(){return 1}get isSetup(){return this.#e}async init(){if(!window.indexedDB)throw console.log("Your browser doesn't support IndexedDB"),new Error("IndexDB is not supported");this.db=await this.#r(),this.isSetup&&await this.setup()}needSetup(e){return 0==e}setup(){}ls(e,r=!1,n=0,t=100){return this.#n(o(e),r,n,t)}tail(e,r=0,n=50){return this.#n(o(e),!0,r,n)}lsByIndex(e,r,n,t=!1,a=30,s=0){return this.#t(o(e),r,n,s,a,t)}lsByRating(e,r,n){return this.#a(o(e),"rating",r,n,!0)}lsByRange(e,r,n,t,a=!1,s=50){return this.#o(o(e),r,n,t,a,s)}latest(e,r=0,n=100){return this.#t(o(e),"ts",0,r,n,!0)}count(e){return this.#s(o(e))}put(r,n){return e.put(this.db,o(r),n)}update(e,...r){return this.#i(o(e),...r)}updateByIndex(e,...r){return this.#c(o(e),...r)}push(e,...r){return this.#l(o(e),...r)}get(e,r){return this.#u(o(e),r)}rm(e,r){return this.#f(o(e),r)}rmByIndex(e,r,n){return this.#y(o(e),r,n)}pushValue(e,r,n,t){return this.#A(o(e),r,n,t)}pushValueByIndex(e,r,n,t,a){return this.#w(o(e),r,n,t,a)}deleteValue(e,...r){return this.#h(o(e),...r)}deleteValueByIndex(e,...r){return this.#I(o(e),...r)}add(e,r){return this.#d(o(e),r)}getById(e){return this.#u(kContact,e)}getByEmail(e){return this.#v(kContact,"email",e)}getByIndex(e,r,n){return this.#v(e,r,n)}#r(){const e=this.name,r=this.version;return new Promise(((n,t)=>{const a=indexedDB.open(e,r);a.onerror=e=>{console.error(`Database error: ${e.target.errorCode}`),t(e.target.errorCode)},a.onsuccess=e=>{const r=e.target.result;n(r)},a.onupgradeneeded=e=>{const r=e.target.result,n=e.target.transaction,t=e.oldVersion;this.onUpgrade(r,n,t),this.needSetup(t)&&(this.#e=!0)}}))}#t(e,r,n,t=0,a=50,o=!1){return new Promise(((s,i)=>{const c=this.db.transaction(e,"readonly").objectStore(e),l=n?IDBKeyRange.only(n):IDBKeyRange.lowerBound(0),u=c.index(r).openCursor(l,o?"prev":"next");let f=0==t,y=0;const A=[];u.onsuccess=e=>{const r=e.target.result;if(r)if(f){const e=r.value;A.push(e),y++,y<a?r.continue():s(A)}else f=!0,r.advance(t);else s(A)},u.onerror=e=>{i(e)}}))}addOne(e,r){return new Promise(((n,t)=>{let a=this.db.transaction(e,"readwrite").objectStore(e).add(r);a.onsuccess=n,a.onerror=t}))}#f(e,r){return new Promise(((n,t)=>{const a=this.db.transaction(e,"readwrite").objectStore(e);let o=r?a.delete(r):a.clear();o.onsuccess=function(e){n()},o.onerror=function(e){console.log(e.target.errorCode),t(e.target.errorCode)}}))}#y(e,r,n){return new Promise(((t,a)=>{const o=this.db.transaction(e,"readwrite").objectStore(e).index(r).openCursor(n);o.onerror=t,o.onsuccess=e=>{const r=e.target.result;r?(r.delete(),r.continue()):t()}}))}#d(e,r){const n=this.db.transaction(e,"readwrite").objectStore(e);Array.isArray(r)||(r=[r]),console.log("IndexDB: adding new entries =>",e,"\n",r.map((e=>e.id)));const t=[];for(const e of r)t.push(new Promise(((r,t)=>{let a=n.add(e);a.onsuccess=function(e){r()},a.onerror=t})));return Promise.all(t)}#i(e,r,n,t={}){return new Promise(((a,o)=>{const s=this.db.transaction(e,"readwrite").objectStore(e),i=s.openCursor(IDBKeyRange.only(r));i.onsuccess=e=>{const i=e.target.result;let c;if(i){const e=Object.assign(i.value,n);Object.deleteUndefined(e),c=i.update(e)}else{const e={id:r,...t,...n};c=s.add(e)}c.onsuccess=function(e){a()},c.onerror=o},i.onerror=o}))}#c(e,r,n,t,a={}){return new Promise(((o,s)=>{const i=this.db.transaction(e,"readwrite").objectStore(e),c=i.index(r).openCursor(n);c.onsuccess=e=>{const r=e.target.result;let n;if(r){const e=Object.assign(r.value,t);Object.deleteUndefined(e),n=r.update(e)}else{const e={...a,...t};n=i.add(e)}n.onsuccess=function(e){o()},n.onerror=s},c.onerror=s}))}#A(e,n,t,a){return new Promise(((o,s)=>{const i=this.db.transaction(e,"readwrite").objectStore(e).openCursor(IDBKeyRange.only(n));r(t,a,i,o,s)}))}#w(e,n,t,a,o){return new Promise(((s,i)=>{const c=this.db.transaction(e,"readwrite").objectStore(e).index(n).openCursor(t);r(a,o,c,s,i)}))}#h(e,r,n,t){return new Promise(((o,s)=>{const i=this.db.transaction(e,"readwrite").objectStore(e).openCursor(IDBKeyRange.only(r));a(n,t,i,o,s)}))}#I(e,r,n,t,o){return new Promise(((s,i)=>{const c=this.db.transaction(e,"readwrite").objectStore(e).index(r).openCursor(n);a(t,o,c,s,i)}))}#l(e,r,n,t){return new Promise(((a,o)=>{const s=this.db.transaction(e,"readwrite").objectStore(e).openCursor(IDBKeyRange.only(r));s.onsuccess=e=>{const r=e.target.result;let s;if(!r)return o("Appending to non-existing record");const i=r.value;i[n]?i[n].push(t):i[n]=[t],i.ts&&(i.ts=Date.seconds()),s=r.update(i),s.onsuccess=function(e){console.log(e),a()},s.onerror=function(e){console.log(e.target.errorCode),o(e.target.errorCode)}},s.onerror=o}))}#u(e,r){return new Promise(((n,t)=>{let a=this.db.transaction(e,"readonly").objectStore(e).get(r);a.onsuccess=e=>{e.target.result?n(e.target.result):n(null)},a.onerror=t}))}#v(e,r,n){return new Promise(((t,a)=>{let o=this.db.transaction(e,"readonly").objectStore(e).index(r).get(n);o.onsuccess=e=>{t(o.result)},o.onerror=a}))}#n(e,r,n,t){return new Promise(((n,a)=>{const o=this.db.transaction(e,"readonly").objectStore(e),s=[],i=o.openCursor(null,r?"prev":"next");let c=0;i.onsuccess=e=>{let r=e.target.result;if(r){let e=r.value;s.push(e),++c<t?r.continue():n(s)}else n(s)},i.onerror=a}))}#a(e,r,n=0,t=50,a=!1){return new Promise(((o,s)=>{const i=this.db.transaction(e,"readonly").objectStore(e),c=IDBKeyRange.lowerBound(0),l=i.index(r).openCursor(c,a?"prev":"next");let u=0==n,f=0;const y=[];l.onsuccess=e=>{const r=e.target.result;if(r)if(u){const e=r.value;y.push(e),f++,f<t?r.continue():o(y)}else u=!0,r.advance(n);else o(y)},l.onerror=s}))}#o(e,r,n,t,a=!1,o=50){return new Promise(((s,i)=>{const c=this.db.transaction(e,"readonly").objectStore(e);let l;l=n?t?IDBKeyRange.bound(n,t,!1,!0):IDBKeyRange.lowerBound(n):IDBKeyRange.upperBound(t,!0);const u=c.index(r).openCursor(l,a?"prev":"next"),f=[];let y=0;u.onsuccess=e=>{let r=e.target.result;if(r){let e=r.value;f.push(e),++y<o?r.continue():s(f)}else s(f)},u.onerror=i}))}#s(e){return new Promise(((r,n)=>{const t=this.db.transaction(e,"readonly").objectStore(e).count();t.onsuccess=e=>{const n=e.target.result;r(n)},t.onerror=n}))}#p(e){return new Promise(((r,n)=>{const t=this.db.transaction(e,"readonly").objectStore(e).clear();t.onsuccess=()=>r(),t.onerror=n}))}delete(e,r,n,t){return new Promise(((a,o)=>{const s=this.db.transaction(e,"readwrite").objectStore(e);let i,c;r?(i=n==t?IDBKeyRange.only(n):n?t?IDBKeyRange.bound(n,t,!1,!0):IDBKeyRange.lowerBound(n):IDBKeyRange.upperBound(t,!0),c=s.index(r).openCursor(i)):c=s.openCursor(),c.onsuccess=e=>{let r=e.target.result;r?(r.delete(),r.continue()):a()},c.onerror=o}))}static put(e,r,n){const t=e.transaction(r,"readwrite").objectStore(r);Array.isArray(n)||(n=[n]);const a=[];for(const e of n)a.push(new Promise(((r,n)=>{let a=t.put(e);a.onsuccess=function(e){r()},a.onerror=n})));return Promise.all(a)}static addTable=s;static addIndex=c;static deleteTable=i;static deleteIndex=l}function r(e,r,n,t,a){n.onsuccess=n=>{const o=n.target.result;let s;if(o){const n=o.value;n[e]||(n[e]=[]),Array.isArray(r)?n[e].push(...r):n[e].push(r),s=o.update(n),s.onsuccess=t,s.onerror=a}else t()},n.onerror=a}function a(e,r,n,t,a){n.onsuccess=n=>{const o=n.target.result;let s;if(o){const n=o.value,i=n[e];Array.isArray(i)&&r?n[e]=i.filter((e=>e!=r)):delete n[e],s=o.update(n),s.onsuccess=function(e){t()},s.onerror=a}else t()},n.onerror=a}function o(e){return"article"===e?"news":e}function s(e,r,n=!1,t="id"){const a={keyPath:t,autoIncrement:n};e.createObjectStore(r,a)}function i(e,r){e.deleteObjectStore(r)}function c(e,r,n,t=!1,a=r){n.objectStore(e).createIndex(a,r,{unique:t})}function l(e,r,n){n.objectStore(e).deleteIndex(r)}const u=0,f={EVAL_NONE:0,EVAL_EVAL:1,EVAL_ROLLOUT:2},y={CMARK_NONE:0,CMARK_ROLLOUT:1},A={CLASS_OVER:0,CLASS_HYPERGAMMON1:1,CLASS_HYPERGAMMON2:2,CLASS_HYPERGAMMON3:3,CLASS_BEAROFF2:4,CLASS_BEAROFF_TS:5,CLASS_BEAROFF1:6,CLASS_BEAROFF_OS:7,CLASS_RACE:8,CLASS_CRASHED:9,CLASS_CONTACT:10},w={NNSTATE_NONE:-1,NNSTATE_INCREMENTAL:0,NNSTATE_DONE:1},h={DP:0,NDW:0,DTW:1,NDWG:1,NDWB:2,DTWG:3,DTWB:4,NDL:5,DTL:6,NDLG:6,NDLB:7,DTLG:8,DTLB:9,DPP0:10,DTWP0:11,NDWBP0:12,DTWGP0:13,DTWBP0:14,NDLP0:15,DTLP0:16,NDLBP0:17,DTLGP0:18,DTLBP0:19,DPP1:20,DTWP1:21,NDWBP1:22,DTWGP1:23,DTWBP1:24,NDLP1:25,DTLP1:26,NDLBP1:27,DTLGP1:28,DTLBP1:29},I=0,d=4;function v(e=!0){const r=new Uint32Array(25).fill(0);return e&&(r[5]=5,r[7]=3,r[12]=5,r[23]=2),[r,new Uint32Array(r)]}function p(){return{nCube:0,fCubeOwner:0,fMove:0,nMatchTo:0,anScore:[0,0],fCrawford:0,fJacoby:0,fBeavers:0,arGammonPrice:new Float32Array(4),bgv:I}}function M(){return new Uint32Array(7).fill(0)}function S(e=!0,r=1,n=!1){return{fCubeful:e,nPlies:r,fUsePrune:n,fDeterministic:!0,rNoise:0}}function b(){return{et:0,ec:S(),rc:{aecCube:[S(!1,2),S(!1,2)],aecChequer:[S(!1,0),S(!1,0)],aecCubeLate:[S(!1,2),S(!1,2)],aecChequerLate:[S(!1,0),S(!1,0)],aecCubeTrunc:S(!1,2),aecChequerTrunc:S(!1,2),aaamfChequer:[m(d),m(d)],aaamfLate:[m(d),m(d)],fCubeful:!1,fVarRedn:!0,fInitial:!1,fRotate:!0,fTruncBearoff2:!0,fTruncBearoffOS:!0,fLateEvals:!1,fDoTruncate:!0,fStopOnSTD:!1,fStopOnJsd:!1,fStopMoveOnJsd:!1,nTruncate:10,nTrials:1296,nLate:5,nSeed:0,nMinimumGames:324,rStdLimit:.01,nMinimumJsdGames:324,rJsdLimit:2.33,nGamesDone:0,rStoppedOnJSD:0,nSkip:0}}}function C(e=0,r=0,n=0){return{Accept:e,Extra:r,Threshold:n}}function m(e="normal"){return{tiny:[[C(0,5,.08),C(),C(),C()],[C(0,5,.08),C(-1),C(),C()],[C(0,5,.08),C(-1),C(0,2,.02),C()],[C(0,5,.08),C(-1),C(0,2,.02),C(-1)]],narrow:[[C(0,8,.12),C(),C(),C()],[C(0,8,.12),C(-1),C(),C()],[C(0,8,.12),C(-1),C(0,2,.03),C()],[C(0,8,.12),C(-1),C(0,2,.03),C(-1)]],normal:[[C(0,8,.16),C(),C(),C()],[C(0,8,.16),C(-1),C(),C()],[C(0,8,.16),C(-1),C(0,2,.04),C()],[C(0,8,.16),C(-1),C(0,2,.04),C(-1)]],large:[[C(0,16,.32),C(),C(),C()],[C(0,16,.32),C(-1),C(),C()],[C(0,16,.32),C(-1),C(0,4,.08),C()],[C(0,16,.32),C(-1),C(0,4,.08),C(-1)]],huge:[[C(0,20,.44),C(),C(),C()],[C(0,20,.44),C(-1),C(),C()],[C(0,20,.44),C(-1),C(0,6,.11),C()],[C(0,20,.44),C(-1),C(0,6,.11),C(-1)]]}[e]}function g(e,r){var n=(65535&e)+(65535&r);return(e>>16)+(r>>16)+(n>>16)<<16|65535&n}function B(e,r,n,t,a,o){return g((s=g(g(r,e),g(t,o)))<<(i=a)|s>>>32-i,n);var s,i}function T(e,r,n,t,a,o,s){return B(r&n|~r&t,e,r,a,o,s)}function P(e,r,n,t,a,o,s){return B(r&t|n&~t,e,r,a,o,s)}function O(e,r,n,t,a,o,s){return B(r^n^t,e,r,a,o,s)}function L(e,r,n,t,a,o,s){return B(n^(r|~t),e,r,a,o,s)}function D(e,r){var n,t,a,o,s;e[r>>5]|=128<<r%32,e[14+(r+64>>>9<<4)]=r;var i=1732584193,c=-271733879,l=-1732584194,u=271733878;for(n=0;n<e.length;n+=16)t=i,a=c,o=l,s=u,i=T(i,c,l,u,e[n],7,-680876936),u=T(u,i,c,l,e[n+1],12,-389564586),l=T(l,u,i,c,e[n+2],17,606105819),c=T(c,l,u,i,e[n+3],22,-1044525330),i=T(i,c,l,u,e[n+4],7,-176418897),u=T(u,i,c,l,e[n+5],12,1200080426),l=T(l,u,i,c,e[n+6],17,-1473231341),c=T(c,l,u,i,e[n+7],22,-45705983),i=T(i,c,l,u,e[n+8],7,1770035416),u=T(u,i,c,l,e[n+9],12,-1958414417),l=T(l,u,i,c,e[n+10],17,-42063),c=T(c,l,u,i,e[n+11],22,-1990404162),i=T(i,c,l,u,e[n+12],7,1804603682),u=T(u,i,c,l,e[n+13],12,-40341101),l=T(l,u,i,c,e[n+14],17,-1502002290),i=P(i,c=T(c,l,u,i,e[n+15],22,1236535329),l,u,e[n+1],5,-165796510),u=P(u,i,c,l,e[n+6],9,-1069501632),l=P(l,u,i,c,e[n+11],14,643717713),c=P(c,l,u,i,e[n],20,-373897302),i=P(i,c,l,u,e[n+5],5,-701558691),u=P(u,i,c,l,e[n+10],9,38016083),l=P(l,u,i,c,e[n+15],14,-660478335),c=P(c,l,u,i,e[n+4],20,-405537848),i=P(i,c,l,u,e[n+9],5,568446438),u=P(u,i,c,l,e[n+14],9,-1019803690),l=P(l,u,i,c,e[n+3],14,-187363961),c=P(c,l,u,i,e[n+8],20,1163531501),i=P(i,c,l,u,e[n+13],5,-1444681467),u=P(u,i,c,l,e[n+2],9,-51403784),l=P(l,u,i,c,e[n+7],14,1735328473),i=O(i,c=P(c,l,u,i,e[n+12],20,-1926607734),l,u,e[n+5],4,-378558),u=O(u,i,c,l,e[n+8],11,-2022574463),l=O(l,u,i,c,e[n+11],16,1839030562),c=O(c,l,u,i,e[n+14],23,-35309556),i=O(i,c,l,u,e[n+1],4,-1530992060),u=O(u,i,c,l,e[n+4],11,1272893353),l=O(l,u,i,c,e[n+7],16,-155497632),c=O(c,l,u,i,e[n+10],23,-1094730640),i=O(i,c,l,u,e[n+13],4,681279174),u=O(u,i,c,l,e[n],11,-358537222),l=O(l,u,i,c,e[n+3],16,-722521979),c=O(c,l,u,i,e[n+6],23,76029189),i=O(i,c,l,u,e[n+9],4,-640364487),u=O(u,i,c,l,e[n+12],11,-421815835),l=O(l,u,i,c,e[n+15],16,530742520),i=L(i,c=O(c,l,u,i,e[n+2],23,-995338651),l,u,e[n],6,-198630844),u=L(u,i,c,l,e[n+7],10,1126891415),l=L(l,u,i,c,e[n+14],15,-1416354905),c=L(c,l,u,i,e[n+5],21,-57434055),i=L(i,c,l,u,e[n+12],6,1700485571),u=L(u,i,c,l,e[n+3],10,-1894986606),l=L(l,u,i,c,e[n+10],15,-1051523),c=L(c,l,u,i,e[n+1],21,-2054922799),i=L(i,c,l,u,e[n+8],6,1873313359),u=L(u,i,c,l,e[n+15],10,-30611744),l=L(l,u,i,c,e[n+6],15,-1560198380),c=L(c,l,u,i,e[n+13],21,1309151649),i=L(i,c,l,u,e[n+4],6,-145523070),u=L(u,i,c,l,e[n+11],10,-1120210379),l=L(l,u,i,c,e[n+2],15,718787259),c=L(c,l,u,i,e[n+9],21,-343485551),i=g(i,t),c=g(c,a),l=g(l,o),u=g(u,s);return[i,c,l,u]}function x(e){var r,n="",t=32*e.length;for(r=0;r<t;r+=8)n+=String.fromCharCode(e[r>>5]>>>r%32&255);return n}function E(e){var r,n=[];for(n[(e.length>>2)-1]=void 0,r=0;r<n.length;r+=1)n[r]=0;var t=8*e.length;for(r=0;r<t;r+=8)n[r>>5]|=(255&e.charCodeAt(r/8))<<r%32;return n}function F(e){var r,n,t="0123456789abcdef",a="";for(n=0;n<e.length;n+=1)r=e.charCodeAt(n),a+=t.charAt(r>>>4&15)+t.charAt(15&r);return a}function k(e){return unescape(encodeURIComponent(e))}function R(e){return function(e){return x(D(E(e),8*e.length))}(k(e))}function N(e,r){return function(e,r){var n,t,a=E(e),o=[],s=[];for(o[15]=s[15]=void 0,a.length>16&&(a=D(a,8*e.length)),n=0;n<16;n+=1)o[n]=909522486^a[n],s[n]=1549556828^a[n];return t=D(o.concat(E(r)),512+8*r.length),x(D(s.concat(t),640))}(k(e),k(r))}const _=function(e,r,n){return r?n?N(r,e):F(N(r,e)):n?R(e):F(R(e))};function W(e,r,n){let t,a,o;for(o=r-1,t=0;t<r;t++)o+=e[t];for(a=1<<o,t=0;t<r-1;t++)o-=e[t]+1,a|=1<<o;return K(a,n+r,r)}function H(e,r){for(let n=0,t=0;n<3;n++,t+=8)r[n]=e[1][t]+(e[1][t+1]<<4)+(e[1][t+2]<<8)+(e[1][t+3]<<12)+(e[1][t+4]<<16)+(e[1][t+5]<<20)+(e[1][t+6]<<24)+(e[1][t+7]<<28),r[n+3]=e[0][t]+(e[0][t+1]<<4)+(e[0][t+2]<<8)+(e[0][t+3]<<12)+(e[0][t+4]<<16)+(e[0][t+5]<<20)+(e[0][t+6]<<24)+(e[0][t+7]<<28);r[6]=e[0][24]+(e[1][24]<<4)}function V(e,r){for(let n=0,t=0;n<3;n++,t+=8)e[1][t]=15&r[n],e[1][t+1]=r[n]>>4&15,e[1][t+2]=r[n]>>8&15,e[1][t+3]=r[n]>>12&15,e[1][t+4]=r[n]>>16&15,e[1][t+5]=r[n]>>20&15,e[1][t+6]=r[n]>>24&15,e[1][t+7]=r[n]>>28&15,e[0][t]=15&r[n+3],e[0][t+1]=r[n+3]>>4&15,e[0][t+2]=r[n+3]>>8&15,e[0][t+3]=r[n+3]>>12&15,e[0][t+4]=r[n+3]>>16&15,e[0][t+5]=r[n+3]>>20&15,e[0][t+6]=r[n+3]>>24&15,e[0][t+7]=r[n+3]>>28&15;e[0][24]=15&r[6],e[1][24]=r[6]>>4&15}function G(e,r){const n=r;for(let r=0,t=0;r<3;r++,t+=8)e[0][t]=15&n[r],e[0][t+1]=n[r]>>4&15,e[0][t+2]=n[r]>>8&15,e[0][t+3]=n[r]>>12&15,e[0][t+4]=n[r]>>16&15,e[0][t+5]=n[r]>>20&15,e[0][t+6]=n[r]>>24&15,e[0][t+7]=n[r]>>28&15,e[1][t]=15&n[r+3],e[1][t+1]=n[r+3]>>4&15,e[1][t+2]=n[r+3]>>8&15,e[1][t+3]=n[r+3]>>12&15,e[1][t+4]=n[r+3]>>16&15,e[1][t+5]=n[r+3]>>20&15,e[1][t+6]=n[r+3]>>24&15,e[1][t+7]=n[r+3]>>28&15;e[1][24]=15&n[6],e[0][24]=n[6]>>4&15}function j(e,r){return e[0]==r[0]&&e[1]==r[1]&&e[2]==r[2]&&e[3]==r[3]&&e[4]==r[4]&&e[5]==r[5]&&e[6]==r[6]}const U=40,z=2,q=new Array(U);let Y=!1;function K(e,r,n){return r==n?0:e&1<<r-1?function(e,r){return Y||function(){let e,r;for(e=0;e<U;e++)q[e]=new Uint32Array(z),q[e][0]=e+1;for(r=1;r<z;r++)q[0][r]=0;for(e=1;e<U;e++)for(r=1;r<z;r++)q[e][r]=q[e-1][r-1]+q[e-1][r];Y=!0}(),q[e-1][r-1]}(r-1,n)+K(e,r-1,n-1):K(e,r-1,n)}const J={BEAROFF_INVALID:0,BEAROFF_ONESIDED:1,BEAROFF_TWOSIDED:2,BEAROFF_HYPERGAMMON:3};function X(e,r,n,t,a,o,s){return e?(e.bt,J.BEAROFF_ONESIDED,e.fND?ReadBearoffOneSidedND(e,r,n,t,a,o,s):ReadBearoffOneSidedExact(e,r,n,t,a,o,s)):-1}const $=[[new Int32Array([36,0,0,0,0]),new Int32Array([36,0,0,0,0]),new Int32Array([6,1080,0,0,0]),new Int32Array([6,1080,0,0,0]),new Int32Array([0,396,32400,0,0]),new Int32Array([0,396,32400,0,0])],[new Int32Array([36,0,0,0,0]),new Int32Array([26,360,0,0,0]),new Int32Array([5,1116,0,0,0]),new Int32Array([5,596,18720,0,0]),new Int32Array([0,335,33596,36e3,0]),new Int32Array([0,235,17666,739080,0])],[new Int32Array([36,0,0,0,0]),new Int32Array([6,1080,0,0,0]),new Int32Array([5,1116,0,0,0]),new Int32Array([5,1116,0,0,0]),new Int32Array([5,1116,0,0,0]),new Int32Array([5,1016,3600,0,0]),new Int32Array([0,396,32400,0,0]),new Int32Array([0,396,32400,0,0]),new Int32Array([0,376,33120,0,0]),new Int32Array([0,335,34596,0,0]),new Int32Array([0,396,32400,0,0]),new Int32Array([0,376,33120,0,0]),new Int32Array([0,335,34596,0,0]),new Int32Array([0,335,33596,36e3,0]),new Int32Array([0,335,27296,262800,0])],[new Int32Array([36,0,0,0,0]),new Int32Array([17,684,0,0,0]),new Int32Array([4,999,5508,0,0]),new Int32Array([4,297,30082,25128,0]),new Int32Array([0,272,24281,450484,90144]),new Int32Array([0,120,11765,983521,4213260])],[new Int32Array([34,72,0,0,0]),new Int32Array([5,1116,0,0,0]),new Int32Array([4,1148,144,0,0]),new Int32Array([4,1148,144,0,0]),new Int32Array([4,1080,2592,0,0]),new Int32Array([4,739,14860,288,0]),new Int32Array([0,396,32400,0,0]),new Int32Array([0,371,33292,288,0]),new Int32Array([0,298,35716,7632,0]),new Int32Array([0,272,34033,101900,576]),new Int32Array([0,388,32680,288,0]),new Int32Array([0,322,34856,7488,0]),new Int32Array([0,272,34794,74504,576]),new Int32Array([0,272,27197,346480,55152]),new Int32Array([0,256,15488,772640,634752])],[new Int32Array([25,396,0,0,0]),new Int32Array([5,1112,144,0,0]),new Int32Array([4,1112,1440,0,0]),new Int32Array([4,631,18756,0,0]),new Int32Array([4,615,19324,288,0]),new Int32Array([4,523,22528,4176,0]),new Int32Array([0,333,33656,36432,0]),new Int32Array([0,322,33854,43560,0]),new Int32Array([0,297,33393,92540,576]),new Int32Array([0,272,30181,240284,10944]),new Int32Array([0,233,17737,739100,576]),new Int32Array([0,217,18281,739964,10944]),new Int32Array([0,192,18895,747036,127008]),new Int32Array([0,192,17551,782404,595584]),new Int32Array([0,184,14192,886751,1565604])],[new Int32Array([5,1116,0,0,0]),new Int32Array([4,1148,144,0,0]),new Int32Array([4,1048,3744,0,0]),new Int32Array([4,999,5508,0,0]),new Int32Array([0,392,32544,0,0]),new Int32Array([0,375,33156,0,0]),new Int32Array([0,355,33868,288,0]),new Int32Array([0,335,34588,288,0]),new Int32Array([0,331,34624,4176,0]),new Int32Array([0,297,35266,25128,0]),new Int32Array([0,371,33292,288,0]),new Int32Array([0,331,34732,288,0]),new Int32Array([0,298,35716,7632,0]),new Int32Array([0,331,33728,36432,0]),new Int32Array([0,297,34754,43560,0]),new Int32Array([0,272,34033,101900,576]),new Int32Array([0,330,27470,263016,0]),new Int32Array([0,297,28537,267356,576]),new Int32Array([0,272,28421,303644,10944]),new Int32Array([0,272,24281,450484,90144])],[new Int32Array([34,72,0,0,0]),new Int32Array([11,880,720,0,0]),new Int32Array([3,751,15482,9e3,0]),new Int32Array([3,163,30547,225808,104400]),new Int32Array([0,195,14249,822591,3288276]),new Int32Array([0,57,8951,767859,18563364])],[new Int32Array([29,252,0,0,0]),new Int32Array([5,1116,0,0,0]),new Int32Array([3,1115,2628,0,0]),new Int32Array([3,1146,1512,0,0]),new Int32Array([3,899,10284,4320,0]),new Int32Array([3,452,25549,34076,576]),new Int32Array([0,392,32544,0,0]),new Int32Array([0,333,34408,9360,0]),new Int32Array([0,236,35179,106580,26496]),new Int32Array([0,207,27064,426011,397044]),new Int32Array([0,357,33552,9072,0]),new Int32Array([0,249,35142,91080,25920]),new Int32Array([0,207,28985,359990,284184]),new Int32Array([0,207,16674,753203,2083572]),new Int32Array([0,165,8770,941530,7506936])],[new Int32Array([23,468,0,0,0]),new Int32Array([5,1086,1080,0,0]),new Int32Array([3,1043,5212,288,0]),new Int32Array([3,659,19036,288,0]),new Int32Array([3,583,21510,9720,0]),new Int32Array([3,368,27767,62980,4608]),new Int32Array([0,325,33734,43992,0]),new Int32Array([0,289,33359,103644,18144]),new Int32Array([0,235,30691,266808,121392]),new Int32Array([0,207,23831,532351,758772]),new Int32Array([0,223,18071,739532,18720]),new Int32Array([0,175,19349,750336,212976]),new Int32Array([0,147,18301,802935,983988]),new Int32Array([0,147,13709,895395,3606660]),new Int32Array([0,129,9184,920983,9389700])],[new Int32Array([5,1112,144,0,0]),new Int32Array([3,1144,1584,0,0]),new Int32Array([3,1055,4788,0,0]),new Int32Array([3,857,11792,4464,0]),new Int32Array([0,385,32796,0,0]),new Int32Array([0,371,33292,288,0]),new Int32Array([0,321,34738,13032,0]),new Int32Array([0,335,34472,4464,0]),new Int32Array([0,308,34657,32780,576]),new Int32Array([0,235,34181,143452,39168]),new Int32Array([0,345,33984,9072,0]),new Int32Array([0,309,35268,9504,0]),new Int32Array([0,236,35555,93060,25920]),new Int32Array([0,309,34282,45e3,0]),new Int32Array([0,235,34783,122124,26784]),new Int32Array([0,207,28547,375536,292176]),new Int32Array([0,307,28169,267628,1152]),new Int32Array([0,235,29373,316128,54e3]),new Int32Array([0,207,25276,488623,460260]),new Int32Array([0,207,15791,778381,2321532])],[new Int32Array([17,680,144,0,0]),new Int32Array([4,983,6076,288,0]),new Int32Array([3,923,9488,1872,0]),new Int32Array([3,333,29949,29900,576]),new Int32Array([3,331,29167,60532,4608]),new Int32Array([3,283,29081,125244,25920]),new Int32Array([0,263,24605,449718,117720]),new Int32Array([0,245,24912,457129,292860]),new Int32Array([0,222,23475,526367,735732]),new Int32Array([0,207,19394,669443,1573812]),new Int32Array([0,120,11720,984849,4223772]),new Int32Array([0,108,11969,985331,4443588]),new Int32Array([0,93,12122,963477,5731884]),new Int32Array([0,93,11334,906514,8803800]),new Int32Array([0,93,9540,858470,12858408])],[new Int32Array([4,1132,720,0,0]),new Int32Array([3,1091,3484,288,0]),new Int32Array([3,775,14808,2160,0]),new Int32Array([3,715,16754,9864,0]),new Int32Array([0,367,33436,288,0]),new Int32Array([0,296,35680,11504,576]),new Int32Array([0,284,35649,28172,576]),new Int32Array([0,268,34079,105284,5760]),new Int32Array([0,252,33761,136812,29376]),new Int32Array([0,222,32167,230992,104400]),new Int32Array([0,309,35114,15032,576]),new Int32Array([0,259,35139,78796,5472]),new Int32Array([0,223,34893,133328,40752]),new Int32Array([0,258,27701,345954,74088]),new Int32Array([0,222,28523,359568,198288]),new Int32Array([0,207,25658,472035,562356]),new Int32Array([0,246,15840,772067,665748]),new Int32Array([0,210,17074,766333,952524]),new Int32Array([0,195,16968,761467,1964916]),new Int32Array([0,195,13487,839379,3671460])],[new Int32Array([4,1089,2268,0,0]),new Int32Array([3,647,19404,2592,0]),new Int32Array([3,559,22396,8928,0]),new Int32Array([3,527,23025,27740,576]),new Int32Array([0,313,34013,49484,576]),new Int32Array([0,293,33443,95796,5184]),new Int32Array([0,277,32921,134556,32832]),new Int32Array([0,267,30329,241e3,26640]),new Int32Array([0,252,30183,263560,103536]),new Int32Array([0,222,28408,360893,299628]),new Int32Array([0,211,18473,740252,31680]),new Int32Array([0,186,19069,747694,157752]),new Int32Array([0,162,19534,758017,303228]),new Int32Array([0,185,17752,783317,628812]),new Int32Array([0,162,18254,788219,874836]),new Int32Array([0,147,17470,814155,1657044]),new Int32Array([0,180,14314,886931,1587636]),new Int32Array([0,155,15088,882887,1896516]),new Int32Array([0,141,14977,868919,3196404]),new Int32Array([0,141,12630,886913,5590332])],[new Int32Array([3,1019,6076,288,0]),new Int32Array([0,355,33824,1872,0]),new Int32Array([0,331,34492,8928,0]),new Int32Array([0,297,35133,29900,576]),new Int32Array([0,284,34771,59668,4608]),new Int32Array([0,285,35948,16112,576]),new Int32Array([0,284,35025,50636,576]),new Int32Array([0,259,34403,105284,5760]),new Int32Array([0,222,34305,155740,42624]),new Int32Array([0,283,28939,270876,6048]),new Int32Array([0,258,28885,304624,27504]),new Int32Array([0,222,29275,334920,111024]),new Int32Array([0,258,24785,449718,117720]),new Int32Array([0,221,25756,457849,292860]),new Int32Array([0,207,23447,546031,763956])],[new Int32Array([31,180,0,0,0]),new Int32Array([6,975,3772,288,0]),new Int32Array([2,466,25089,78660,18144]),new Int32Array([2,84,23554,584297,1627164]),new Int32Array([0,116,6951,880249,14356620]),new Int32Array([0,18,6042,425561,36475740])],[new Int32Array([23,468,0,0,0]),new Int32Array([4,1148,144,0,0]),new Int32Array([2,995,8200,1584,0]),new Int32Array([2,1066,5688,0,0]),new Int32Array([2,603,22062,10568,576]),new Int32Array([2,205,32081,163840,67248]),new Int32Array([0,383,32860,288,0]),new Int32Array([0,254,35419,75284,2304]),new Int32Array([0,154,29734,402111,269892]),new Int32Array([0,140,15913,828583,3482100]),new Int32Array([0,296,34104,68256,0]),new Int32Array([0,164,30562,363296,127584]),new Int32Array([0,136,17946,801264,2017440]),new Int32Array([0,120,7889,1002899,8538948]),new Int32Array([0,70,5652,775017,21974652])],[new Int32Array([19,608,144,0,0]),new Int32Array([4,1065,3132,0,0]),new Int32Array([2,884,12012,8208,0]),new Int32Array([2,655,20336,5328,0]),new Int32Array([2,444,26523,55852,7200]),new Int32Array([2,189,30326,243663,214596]),new Int32Array([0,304,33253,88380,5184]),new Int32Array([0,224,30938,271784,135360]),new Int32Array([0,153,24544,564925,1181484]),new Int32Array([0,140,14007,849405,5202684]),new Int32Array([0,193,18775,748820,171648]),new Int32Array([0,117,18938,811339,1255572]),new Int32Array([0,100,13699,913601,5157036]),new Int32Array([0,92,7775,917424,13070160]),new Int32Array([0,62,5739,706619,24697476])],[new Int32Array([4,1130,792,0,0]),new Int32Array([2,1063,5796,0,0]),new Int32Array([2,991,8364,864,0]),new Int32Array([2,587,22351,20884,1152]),new Int32Array([0,371,33292,288,0]),new Int32Array([0,357,33712,3312,0]),new Int32Array([0,246,35383,86828,6624]),new Int32Array([0,327,34262,22392,0]),new Int32Array([0,237,34453,131064,39312]),new Int32Array([0,152,28396,445719,527364]),new Int32Array([0,288,34388,68400,0]),new Int32Array([0,260,35352,69984,0]),new Int32Array([0,158,30668,367220,128880]),new Int32Array([0,259,34481,102492,5184]),new Int32Array([0,157,30147,385270,200952]),new Int32Array([0,140,17532,803268,2295216]),new Int32Array([0,257,28879,305844,38016]),new Int32Array([0,155,26546,508717,517068]),new Int32Array([0,140,16334,823115,3133332]),new Int32Array([0,124,7589,978016,9636912])],[new Int32Array([14,776,576,0,0]),new Int32Array([4,913,8552,1872,0]),new Int32Array([2,767,15983,16868,576]),new Int32Array([2,360,29605,53820,5184]),new Int32Array([2,300,28857,156860,64512]),new Int32Array([2,176,27944,340841,409788]),new Int32Array([0,243,24528,474225,268380]),new Int32Array([0,198,22633,576764,1132416]),new Int32Array([0,150,18321,737255,3182580]),new Int32Array([0,140,12063,859951,7342452]),new Int32Array([0,108,11969,977637,4720572]),new Int32Array([0,76,12092,946693,7168140]),new Int32Array([0,64,10674,863340,12566448]),new Int32Array([0,64,7844,761133,19913580]),new Int32Array([0,52,6032,616407,28031940])],[new Int32Array([4,1099,1908,0,0]),new Int32Array([2,1019,7348,1152,0]),new Int32Array([2,751,16778,9e3,0]),new Int32Array([2,520,23769,56524,6336]),new Int32Array([0,342,34202,5112,0]),new Int32Array([0,292,35133,36292,3744]),new Int32Array([0,225,34874,131282,45720]),new Int32Array([0,268,32812,150088,34848]),new Int32Array([0,220,30222,298601,284508]),new Int32Array([0,150,25691,530366,1079064]),new Int32Array([0,262,35170,73880,2304]),new Int32Array([0,222,34976,132004,27504]),new Int32Array([0,154,30031,392356,236160]),new Int32Array([0,220,28078,378260,195408]),new Int32Array([0,151,25786,529760,931104]),new Int32Array([0,140,16413,821065,3104748]),new Int32Array([0,210,16875,771659,1018692]),new Int32Array([0,140,17488,793184,2715264]),new Int32Array([0,132,12957,858233,6618924]),new Int32Array([0,128,6962,908191,12776580])],[new Int32Array([4,1035,4204,288,0]),new Int32Array([2,642,20738,7704,0]),new Int32Array([2,555,23523,20180,576]),new Int32Array([2,410,27049,80676,18144]),new Int32Array([0,290,33665,91628,7488]),new Int32Array([0,275,33057,132372,28512]),new Int32Array([0,212,30778,291535,191556]),new Int32Array([0,253,29938,271332,94608]),new Int32Array([0,208,27684,401077,444492]),new Int32Array([0,151,23054,608233,1646748]),new Int32Array([0,184,19038,750756,181008]),new Int32Array([0,164,19390,761061,286956]),new Int32Array([0,113,18750,820147,1368756]),new Int32Array([0,164,17961,797571,824580]),new Int32Array([0,111,17708,838828,2139984]),new Int32Array([0,100,13209,915715,5715972]),new Int32Array([0,158,14796,886873,1991484]),new Int32Array([0,106,15120,886295,4018500]),new Int32Array([0,96,12026,896601,8123868]),new Int32Array([0,92,7533,877093,14835708])],[new Int32Array([2,963,9344,1872,0]),new Int32Array([0,331,34550,6840,0]),new Int32Array([0,311,34757,25292,576]),new Int32Array([0,292,34669,52956,5184]),new Int32Array([0,225,34049,160400,66672]),new Int32Array([0,242,35841,75644,2304]),new Int32Array([0,242,34959,107252,7488]),new Int32Array([0,222,34300,156216,31968]),new Int32Array([0,153,29610,407273,291420]),new Int32Array([0,240,29401,308924,43776]),new Int32Array([0,220,29234,339556,90576]),new Int32Array([0,151,26258,521963,600084]),new Int32Array([0,220,25312,475809,268380]),new Int32Array([0,149,23843,596484,1140480]),new Int32Array([0,140,15529,836357,3699900])],[new Int32Array([10,887,1764,0,0]),new Int32Array([3,719,16407,17156,576]),new Int32Array([2,641,19951,37220,4032]),new Int32Array([2,194,30182,243319,180324]),new Int32Array([2,185,28264,318235,388980]),new Int32Array([2,143,26206,434497,830268]),new Int32Array([0,183,14564,820763,3505716]),new Int32Array([0,160,14565,819849,4610412]),new Int32Array([0,136,13405,831119,6827796]),new Int32Array([0,132,10367,861740,9849312]),new Int32Array([0,55,8811,772043,18687492]),new Int32Array([0,47,8633,762062,19650744]),new Int32Array([0,40,8204,717461,22138956]),new Int32Array([0,40,7232,643295,26068644]),new Int32Array([0,36,6082,562587,30651156])],[new Int32Array([3,1079,3916,288,0]),new Int32Array([2,887,11834,10728,0]),new Int32Array([2,476,25507,51044,4032]),new Int32Array([2,402,27073,90180,18144]),new Int32Array([0,318,34810,14312,576]),new Int32Array([0,232,34908,121056,43200]),new Int32Array([0,200,34336,181552,99648]),new Int32Array([0,200,26978,434919,514404]),new Int32Array([0,176,26107,485813,930780]),new Int32Array([0,147,23378,600873,1678428]),new Int32Array([0,221,35079,128568,64368]),new Int32Array([0,182,29423,372592,429264]),new Int32Array([0,148,27194,487861,754668]),new Int32Array([0,176,17571,762085,2047644]),new Int32Array([0,139,17798,786039,2617380]),new Int32Array([0,132,14067,884661,4228956]),new Int32Array([0,152,9103,939942,7739064]),new Int32Array([0,113,10135,926300,8712288]),new Int32Array([0,100,9481,906351,10884564]),new Int32Array([0,100,6941,887101,14869404])],[new Int32Array([3,985,7264,1584,0]),new Int32Array([2,595,21997,23276,576]),new Int32Array([2,395,27547,82204,17568]),new Int32Array([2,340,27770,144132,65232]),new Int32Array([0,269,33277,131568,52272]),new Int32Array([0,226,30426,285363,216756]),new Int32Array([0,195,28399,389959,524628]),new Int32Array([0,196,23900,538799,950436]),new Int32Array([0,173,22617,594924,1665792]),new Int32Array([0,146,19382,710497,2957436]),new Int32Array([0,159,19533,759847,378612]),new Int32Array([0,133,18457,807913,1255788]),new Int32Array([0,107,17761,834132,2426976]),new Int32Array([0,133,14018,894693,3884652]),new Int32Array([0,105,14160,885933,5322348]),new Int32Array([0,100,11603,903632,8232336]),new Int32Array([0,120,9386,919460,9602640]),new Int32Array([0,92,9959,897073,10972332]),new Int32Array([0,88,9081,845101,14167836]),new Int32Array([0,88,6944,797786,18640728])],[new Int32Array([2,850,13146,11448,0]),new Int32Array([0,310,34855,23044,1152]),new Int32Array([0,296,34455,55420,7200]),new Int32Array([0,232,33661,164996,77472]),new Int32Array([0,200,32377,248703,221076]),new Int32Array([0,209,35429,131512,64656]),new Int32Array([0,208,34703,158780,70560]),new Int32Array([0,182,29012,387017,442620]),new Int32Array([0,147,26918,497879,798372]),new Int32Array([0,207,29618,341130,142776]),new Int32Array([0,181,25868,495979,641268]),new Int32Array([0,146,24254,583029,1232172]),new Int32Array([0,180,16617,776622,2574072]),new Int32Array([0,142,16946,792561,3346812]),new Int32Array([0,136,13415,872781,5315004])],[new Int32Array([3,876,11070,5832,0]),new Int32Array([2,355,29081,78820,17568]),new Int32Array([2,312,28766,144712,59904]),new Int32Array([2,268,28254,217343,161604]),new Int32Array([0,227,24896,477159,432324]),new Int32Array([0,209,23554,535275,919188]),new Int32Array([0,185,22006,601857,1648188]),new Int32Array([0,194,19630,671532,1799280]),new Int32Array([0,172,18904,699721,2751804]),new Int32Array([0,145,16482,774441,4460508]),new Int32Array([0,100,12078,980097,4863996]),new Int32Array([0,87,12104,965251,5971284]),new Int32Array([0,71,11891,942537,7811532]),new Int32Array([0,87,11301,910749,8974044]),new Int32Array([0,70,11128,900933,10344780]),new Int32Array([0,64,10008,845763,14062356]),new Int32Array([0,87,9602,858987,13039380]),new Int32Array([0,70,9669,843115,14317092]),new Int32Array([0,64,8948,788345,17503164]),new Int32Array([0,64,7347,721049,22000716])],[new Int32Array([2,711,17893,20684,576]),new Int32Array([0,277,35301,49644,5184]),new Int32Array([0,250,32889,169600,72432]),new Int32Array([0,216,31766,251079,180900]),new Int32Array([0,191,29823,346777,420300]),new Int32Array([0,196,34817,169610,92808]),new Int32Array([0,195,28619,387703,320724]),new Int32Array([0,180,26178,483327,741636]),new Int32Array([0,147,24325,575456,1366128]),new Int32Array([0,185,17665,769685,1232316]),new Int32Array([0,172,17499,767034,2149416]),new Int32Array([0,137,17091,792659,3388644]),new Int32Array([0,172,14184,836845,3932460]),new Int32Array([0,137,14526,834307,5213556]),new Int32Array([0,132,11813,863857,7899084])],[new Int32Array([2,537,23595,40820,4032]),new Int32Array([0,260,32786,160172,78768]),new Int32Array([0,239,29984,285233,187740]),new Int32Array([0,215,28156,375495,427140]),new Int32Array([0,191,26442,456345,857628]),new Int32Array([0,147,19675,767435,481284]),new Int32Array([0,147,18377,798257,1053900]),new Int32Array([0,133,17615,821824,1846224]),new Int32Array([0,106,17096,842747,3025332]),new Int32Array([0,141,15264,885864,2214432]),new Int32Array([0,128,15090,876847,3371076]),new Int32Array([0,101,14852,877549,4913964]),new Int32Array([0,128,12865,889903,5784660]),new Int32Array([0,100,13053,881311,7156692]),new Int32Array([0,96,11075,873594,10184616])],[new Int32Array([0,278,34449,78676,17568]),new Int32Array([0,196,34220,190904,99936]),new Int32Array([0,195,29493,359469,204444]),new Int32Array([0,195,25955,480507,432324]),new Int32Array([0,180,24042,554123,961236]),new Int32Array([0,146,22638,628265,1698012])]];const Q=0,Z=1,ee=2,re=-1,ne=0,te=1;function ae(e,r,n,t,a){const o=e.cHidden;let s,i,c,l,u;for(s=0;s<o;s++)n[s]=e.arHiddenThreshold[s];for(u=e.arHiddenWeight,s=0;s<e.cInput;s++){const e=r[s];if(0==e)u=u.subarray(o);else{if(l=0,c=0,1==e)for(i=o;i;i--)n[l++]+=u[c++];else for(i=o;i;i--)n[l++]+=u[c++]*e;u=u.subarray(c)}}for(a&&a.set(n.subarray(0,o)),s=0;s<o;s++)n[s]=ce(-e.rBetaHidden*n[s]);for(u=e.arOutputWeight,s=0,c=0;s<e.cOutput;s++){let r=e.arOutputThreshold[s];for(i=0;i<o;i++)r+=n[i]*u[c++];t[s]=ce(-e.rBetaOutput*r)}}function oe(e,r,n,t){const a=new Float32Array(e.cHidden);switch(function(e){if(!e)return Q;switch(e.state){case re:return Q;case ne:return e.state=te,Z;case te:return ee}return Q}(t)){case Q:ae(e,r,a,n,0);break;case Z:t.cSavedIBase=e.cInput,t.savedIBase=new Float32Array(r),t.savedBase||(t.savedBase=new Float32Array(e.cHidden)),ae(e,r,a,n,t.savedBase);break;case ee:if(t.cSavedIBase!=e.cInput){ae(pnn,r,a,n,0);break}a.set(t.savedBase.subarray(0,e.cHidden));for(let n=0;n<e.cInput;++n)r[n]!=t.savedIBase[n]?r[n]-=t.savedIBase[n]:r[n]=0;!function(e,r,n,t){let a,o,s,i,c;for(c=e.arHiddenWeight,a=0;a<e.cInput;++a){const t=r[a];if(0==t)c=c.subarray(e.cHidden);else{if(i=0,s=0,1==t)for(o=e.cHidden;o;o--)n[i++]+=c[s++];else if(-1==t)for(o=e.cHidden;o;o--)n[i++]-=c[s++];else for(o=e.cHidden;o;o--)n[i++]+=c[s++]*t;c=c.subarray(s)}}for(a=0;a<e.cHidden;a++)n[a]=ce(-e.rBetaHidden*n[a]);for(c=e.arOutputWeight,a=0,s=0;a<e.cOutput;a++){let r=e.arOutputThreshold[a];for(o=0;o<e.cHidden;o++)r+=n[o]*c[s++];t[a]=ce(-e.rBetaOutput*r)}}(e,r,a,n)}return 0}function se(e,r){return e.cInput=r.readUint32(),e.cHidden=r.readUint32(),e.cOutput=r.readUint32(),r.readInt32(),e.rBetaHidden=r.readFloat32(),e.rBetaOutput=r.readFloat32(),e.cInput<1||e.cHidden<1||e.cOutput<1||e.rBetaHidden<=0||e.rBetaOutput<=0?(console.error("Failed to load Neaural net from binary"),-1):(e.nTrained=1,console.debug(e),e.arHiddenWeight=r.readFloat32Array(e.cInput*e.cHidden),e.arOutputWeight=r.readFloat32Array(e.cHidden*e.cOutput),e.arHiddenThreshold=r.readFloat32Array(e.cHidden),e.arOutputThreshold=r.readFloat32Array(e.cOutput),le(e.arHiddenWeight),le(e.arOutputWeight),le(e.arHiddenThreshold),le(e.arOutputThreshold),0)}const ie=new Float32Array([.1,.11051709180756478,.12214027581601698,.13498588075760032,.14918246976412702,.1648721270700128,.1822118800390509,.20137527074704767,.2225540928492468,.245960311115695,.27182818284590454,.30041660239464335,.33201169227365473,.36692966676192446,.4055199966844675,.44816890703380646,.4953032424395115,.54739473917272,.6049647464412946,.6685894442279269,.7389056098930651,.8166169912567651,.9025013499434122,.9974182454814718,1.1023176380641602,1.2182493960703473,1.346373803500169,1.4879731724872838,1.644464677109705,1.817414536944306,2.008553692318767,2.2197951281441637,2.4532530197109352,2.711263892065788,2.996410004739701,3.3115451958692312,3.659823444367799,4.0447304360067395,4.470118449330082,4.940244910553017,5.459815003314423,6.034028759736195,6.668633104092516,7.369979369959578,8.145086866496815,9.001713130052181,9.948431564193378,10.994717245212353,12.151041751873485,13.428977968493552,14.84131591025766,16.40219072999017,18.12722418751512,20.033680997479166,22.140641620418716,24.46919322642204,27.042640742615255,29.886740096706028,33.029955990964865,36.503746786532886,40.34287934927351,44.585777008251675,49.27490410932563,54.4571910125929,60.18450378720822,66.51416330443618,73.50951892419727,81.24058251675433,89.78472916504175,99.22747156050262,109.66331584284585,121.19670744925763,133.9430764394418,148.0299927584545,163.5984429995927,180.80424144560632,199.81958951041173,220.8347991887209,244.06019776244983,269.728232826851,298.0957987041728,329.44680752838406,364.0950307332352,402.3872393822313,444.7066747699858,491.47688402991344,543.1659591362978,600.2912217261018,663.4244006277889,733.1973539155995,810.3083927575384,895.5292703482507,989.7129058743909,1093.8019208165192,1208.8380730216988,1335.9726829661872,1476.4781565577266,1631.760719801542,1803.3744927828525,1993.0370438230298,1993.0370438230298]);function ce(e){if(e>=0){if(e<10){const r=10*e,n=parseInt(r);return 1/(1+ie[n]*(10-n+r))}return 1/19931.370438230297}if(e>-10){const r=-10*e,n=parseInt(r);return 1-1/(1+ie[n]*(10-n+r))}return.9999498278353163}function le(e){console.debug("#",e[0],e[e.length-1])}const ue=4294967295;function fe(e,r){let n=r.nEvalContext;n*=3432918353,n=n<<15|n>>17,n*=461845907,n=n<<13|n>>19,n=5*n+3864292196;for(let e=0;e<7;e++){let t=r.key[e];t*=3432918353,t=t<<15|t>>17,t*=461845907,n^=t,n=n<<13|n>>19,n=5*n+3864292196}return n^=n>>16,n*=2246822507,n^=n>>13,n*=3266489909,n^=n>>16,n&e}function ye(e,r){for(e.size=r;0!=(r&r-1);)r&=r-1;e.size=r<e.size?2*r:r,e.hashMask=(e.size>>1)-1,e.entries=[]}function Ae(e,r,n,t){const a=fe(e.hashMask,r);let o=e.entries[a];if(o||(o=he(),e.entries[a]=o),!j(o.nd_primary.key,r.key)||o.nd_primary.nEvalContext!=r.nEvalContext){if(!j(o.nd_secondary.key,r.key)||o.nd_secondary.nEvalContext!=r.nEvalContext)return a;{let e=o.nd_primary;o.nd_primary=o.nd_secondary,o.nd_secondary=e}}return n.set(o.nd_primary.ar.subarray(0,n.length)),ue}function we(e,r,n){let t=e.entries[n];t||(t=he(),e.entries[n]=t),t.nd_secondary=t.nd_primary,t.nd_primary=r}function he(){return{nd_primary:Ie(),nd_secondary:Ie()}}function Ie(){return{key:M(),nEvalContext:0,ar:new Float32Array(6)}}const de=[new Float32Array([0,0,0,0]),new Float32Array([1,0,0,0]),new Float32Array([0,1,0,0]),new Float32Array([0,0,1,0]),new Float32Array([0,0,1,.5]),new Float32Array([0,0,1,1]),new Float32Array([0,0,1,1.5]),new Float32Array([0,0,1,2]),new Float32Array([0,0,1,2.5]),new Float32Array([0,0,1,3]),new Float32Array([0,0,1,3.5]),new Float32Array([0,0,1,4]),new Float32Array([0,0,1,4.5]),new Float32Array([0,0,1,5]),new Float32Array([0,0,1,5.5]),new Float32Array([0,0,1,6])],ve=[new Float32Array([0,0,0,0]),new Float32Array([1,0,0,0]),new Float32Array([1,1,0,0]),new Float32Array([1,1,1,0]),new Float32Array([1,1,1,.5]),new Float32Array([1,1,1,1]),new Float32Array([1,1,1,1.5]),new Float32Array([1,1,1,2]),new Float32Array([1,1,1,2.5]),new Float32Array([1,1,1,3]),new Float32Array([1,1,1,3.5]),new Float32Array([1,1,1,4]),new Float32Array([1,1,1,4.5]),new Float32Array([1,1,1,5]),new Float32Array([1,1,1,5.5]),new Float32Array([1,1,1,6])];function pe(e,r){let n,t;for(n=0;n<2;++n){let a=r.subarray(25*n*4);const o=e[n];for(t=0;t<24;t++){const e=o[t];a[4*t+0]=de[e][0],a[4*t+1]=de[e][1],a[4*t+2]=de[e][2],a[4*t+3]=de[e][3]}{const e=o[24];a[96]=ve[e][0],a[97]=ve[e][1],a[98]=ve[e][2],a[99]=ve[e][3]}}}const Me=0,Se=1,be=2,Ce=3,me=4,ge=5,Be=4,Te=5,Pe=6,Oe=3,Le=4,De=5,xe=6,Ee=7,Fe=8,ke=9,Re=10,Ne=11,_e=12,We=13,He=14,Ve=15,Ge=16,je=17,Ue=18,ze=19,qe=20,Ye=21,Ke=22,Je=23,Xe=24,$e=200,Qe=0,Ze=1,er=3,rr=2,nr=4,tr=5,ar=tr+11,or=5,sr=4294967295,ir=1,cr=2,lr=4,ur=8,fr=A.CLASS_BEAROFF_TS,yr=A.CLASS_BEAROFF_OS,Ar=1<<19,wr=.6,hr=.6,Ir=.00125,dr=.55,vr=.7,pr=.6,Mr=.68,Sr=.68,br={entries:[],hashMask:0,size:0},Cr={entries:[],hashMask:0,size:0},mr=new Array(3875),gr=new Array(3);for(let e=0;e<mr.length;++e)mr[e]={anMove:new Int8Array(8).fill(0),key:M(),cMoves:0,cPips:0,rScore:0,rScore2:0,arEvalMove:new Float32Array(7),arEvalStdDev:new Float32Array(7),esMove:b(),cmark:y.CMARK_NONE};for(let e=0;e<gr.length;++e)gr[e]={state:w.NNSTATE_NONE,savedBase:null,saveIBase:null};const Br=S(!1,0,!1),Tr=m("normal"),Pr=[function(e,r,n){let t,a,o=Dr[n];for(t=0;t<25&&!e[0][t];t++);if(25==t){for(r[Qe]=r[Ze]=r[rr]=0,t=0,a=0;t<25;t++)a+=e[1][t];if(a==o){for(r[er]=1,t=18;t<25;t++)if(e[1][t])return r[nr]=1,0;return r[nr]=0,0}return r[er]=r[nr]=0,0}for(t=0;t<25&&!e[1][t];t++);if(25==t){for(r[Qe]=1,r[er]=r[nr]=0,t=0,a=0;t<25;t++)a+=e[0][t];if(a==o){for(r[Ze]=1,t=18;t<25;t++)if(e[0][t])return r[rr]=1,0;return r[rr]=0,0}r[Ze]=r[rr]=0}return 0},,,,,,,,function(e,r,n,t){const a=new Float32Array(214);return function(e,r){let n;for(n=0;n<2;++n){let t,a,o=e[n],s=r.subarray(107*n),i=15;for(t=0;t<23;++t){const e=o[t];a=4*t,i-=e,s[a++]=1==e?1:0,s[a++]=2==e?1:0,s[a++]=e>=3?1:0,s[a]=e>3?(e-3)/2:0}for(a=0;a<14;++a)s[92+a]=i==a+1?1:0;{let e=0;for(a=1;a<4;++a)for(t=6*a;t<6*a+6;++t){const r=o[t];r&&(e+=r*a)}s[106]=e/10}}}(e,a),oe(Fr,a,r,t?t+(A.CLASS_RACE-A.CLASS_RACE):null)?-1:(On(e,r),0)},function(e,r,n,t){const a=new Float32Array(250);return function(e,r){pe(e,r);{let n=r.subarray(200);Ur(e[1],n.subarray(0)),jr(e[1],e[0],n)}{let n=r.subarray(225);Ur(e[0],n.subarray(0)),jr(e[0],e[1],n)}}(e,a),oe(kr,a,r,t?t[A.CLASS_CRASHED-A.CLASS_RACE]:null)},function(e,r,n,t){const a=new Float32Array(250);return function(e,r){pe(e,r);{let n=r.subarray(200);zr(e[0],n.subarray(0)),jr(e[1],e[0],n)}{let n=r.subarray(225);zr(e[1],n.subarray(0)),jr(e[0],e[1],n)}}(e,a),oe(Er,a,r,t?t[A.CLASS_CONTACT-A.CLASS_RACE]:null)}],Or=null,Lr=null,Dr=new Int32Array([15,15,1,2,3]);function xr(e){const[r,n]=e;return[new Uint32Array(r),new Uint32Array(n)]}const Er={cInput:0,cHidden:0,cOutput:0,nTrained:0,rBetaHidden:0,rBetaOutput:0,arHiddenWeight:null,arOutputWeight:null,arHiddenThreshold:null,arOutputThreshold:null},Fr={cInput:0,cHidden:0,cOutput:0,nTrained:0,rBetaHidden:0,rBetaOutput:0,arHiddenWeight:null,arOutputWeight:null,arHiddenThreshold:null,arOutputThreshold:null},kr={cInput:0,cHidden:0,cOutput:0,nTrained:0,rBetaHidden:0,rBetaOutput:0,arHiddenWeight:null,arOutputWeight:null,arHiddenThreshold:null,arOutputThreshold:null},Rr={cInput:0,cHidden:0,cOutput:0,nTrained:0,rBetaHidden:0,rBetaOutput:0,arHiddenWeight:null,arOutputWeight:null,arHiddenThreshold:null,arOutputThreshold:null},Nr={cInput:0,cHidden:0,cOutput:0,nTrained:0,rBetaHidden:0,rBetaOutput:0,arHiddenWeight:null,arOutputWeight:null,arHiddenThreshold:null,arOutputThreshold:null},_r={cInput:0,cHidden:0,cOutput:0,nTrained:0,rBetaHidden:0,rBetaOutput:0,arHiddenWeight:null,arOutputWeight:null,arHiddenThreshold:null,arOutputThreshold:null},Wr=new Int32Array(4096),Hr=new Int32Array(4096),Vr=new Int32Array([0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1]);function Gr(e,r,n,t,a,o,s,i,c,l){return a?void console.error("Set info match not implemented"):function(e,r,n,t,a,o,s){e.nCube=r,e.fCubeOwner=n,e.fMove=t,e.fJacoby=a,e.fBeavers=o,e.nMatchTo=e.anScore[0]=e.anScore[1]=0,e.fCrawford=!1,e.bgv=s,e.arGammonPrice=a&&-1==n?[0,0,0,0]:[1,1,1,1]}(e,r,n,t,i,c,l)}function jr(e,r,n){let t,a,o,s,i,c,l,u=new Int32Array(39);const f=[new Int32Array([0,-1,-1,-1,-1]),new Int32Array([1,2,-1,-1,-1]),new Int32Array([3,4,5,-1,-1]),new Int32Array([6,7,8,9,-1]),new Int32Array([10,11,12,-1,-1]),new Int32Array([13,14,15,16,17]),new Int32Array([18,19,20,-1,-1]),new Int32Array([21,22,23,24,-1]),new Int32Array([25,26,27,-1,-1]),new Int32Array([28,29,-1,-1,-1]),new Int32Array([30,-1,-1,-1,-1]),new Int32Array([31,32,33,-1,-1]),new Int32Array([-1,-1,-1,-1,-1]),new Int32Array([-1,-1,-1,-1,-1]),new Int32Array([34,-1,-1,-1,-1]),new Int32Array([35,-1,-1,-1,-1]),new Int32Array([-1,-1,-1,-1,-1]),new Int32Array([36,-1,-1,-1,-1]),new Int32Array([-1,-1,-1,-1,-1]),new Int32Array([37,-1,-1,-1,-1]),new Int32Array([-1,-1,-1,-1,-1]),new Int32Array([-1,-1,-1,-1,-1]),new Int32Array([-1,-1,-1,-1,-1]),new Int32Array([38,-1,-1,-1,-1])];function y(e,r,n,t){return{fAll:e,anIntermediate:new Int32Array(r),nFaces:n,nPips:t}}let A;const w=[y(1,[0,0,0],1,1),y(1,[0,0,0],1,2),y(1,[1,0,0],2,2),y(1,[0,0,0],1,3),y(0,[1,2,0],2,3),y(1,[1,2,0],3,3),y(1,[0,0,0],1,4),y(0,[1,3,0],2,4),y(1,[2,0,0],2,4),y(1,[1,2,3],4,4),y(1,[0,0,0],1,5),y(0,[1,4,0],2,5),y(0,[2,3,0],2,5),y(1,[0,0,0],1,6),y(0,[1,5,0],2,6),y(0,[2,4,0],2,6),y(1,[3,0,0],2,6),y(1,[2,4,0],3,6),y(0,[1,6,0],2,7),y(0,[2,5,0],2,7),y(0,[3,4,0],2,7),y(0,[2,6,0],2,8),y(0,[3,5,0],2,8),y(1,[4,0,0],2,8),y(1,[2,4,6],4,8),y(0,[3,6,0],2,9),y(0,[4,5,0],2,9),y(1,[3,6,0],3,9),y(0,[4,6,0],2,10),y(1,[5,0,0],2,10),y(0,[5,6,0],2,11),y(1,[6,0,0],2,12),y(1,[4,8,0],3,12),y(1,[3,6,9],4,12),y(1,[5,10,0],3,15),y(1,[4,8,12],4,16),y(1,[6,12,0],3,18),y(1,[5,10,15],4,20),y(1,[6,12,18],4,24)],h=[new Int32Array([0,2,5,9]),new Int32Array([1,8,17,24]),new Int32Array([3,16,27,33]),new Int32Array([6,23,32,35]),new Int32Array([10,29,34,37]),new Int32Array([13,31,36,38]),new Int32Array([0,1,4,-1]),new Int32Array([0,3,7,-1]),new Int32Array([1,3,12,-1]),new Int32Array([0,6,11,-1]),new Int32Array([1,6,15,-1]),new Int32Array([3,6,20,-1]),new Int32Array([0,10,14,-1]),new Int32Array([1,10,19,-1]),new Int32Array([3,10,22,-1]),new Int32Array([6,10,26,-1]),new Int32Array([0,13,18,-1]),new Int32Array([1,13,21,-1]),new Int32Array([3,13,25,-1]),new Int32Array([6,13,28,-1]),new Int32Array([10,13,30,-1])];{let a=0;for(i=24;i>=0&&!r[i];--i);for(i=23-i,t=i+1;t<25;t++)e[t]&&(a+=(t+1-i)*e[t]);n[Oe]=a/167}{let r=0;for(t=0;t<i;t++)e[t]&&(r+=(t+1)*e[t]);n[Je]=r/100}{let r=0,a=0,o=i>=11?i:11;for(r+=24*e[24],a+=e[24],t=23;t>o;--t)if(e[t]&&2!=e[t]){let n=e[t]>2?e[t]-2:1;a+=n,r+=t*n}for(;t>=6;--t)if(e[t]){let n=e[t];a+=n,r+=t*n}for(t=5;t>=0;--t)if(e[t]>2)r+=t*(e[t]-2),a+=e[t]-2;else if(e[t]<2){let n=2-e[t];a>=n&&(r-=t*n,a-=n)}n[ze]=r/100}{let r;for(r=24;r>=0&&!e[r];--r);for(n[Le]=r/24,t=24==r?23:r;t>=0&&!(e[t]>=2);--t);for(n[De]=t/24,c=0,a=18;a<=t;++a)if(e[a]>=2){c=24-a;break}if(0==c)for(a=17;a>=12;--a)if(e[a]>=2){c=24-a;break}n[xe]=0==c?2:c/6}for(l=0,t=0;t<6;t++)e[t]&&l++;for(u.fill(0),t=l>2?23:21;t>=0;t--)if(1==r[t])for(a=24-t;a<25;a++)if(e[a]&&!(a<6&&2==e[a]))for(c=0;c<5&&-1!=f[a-24+t][c];c++){A=w[f[a-24+t][c]];let e=!1;if(A.fAll){if(A.nFaces>1)for(o=0;o<3&&A.anIntermediate[o]>0;o++)if(r[t-A.anIntermediate[o]]>1){e=!0;break}}else r[t-A.anIntermediate[0]]>1&&r[t-A.anIntermediate[1]]>1&&(e=!0);e||(u[f[a-24+t][c]]|=1<<a)}const I=new Array(21);for(t=0;t<I.length;++t)I[t]={nChequers:0,nPips:0};if(e[24])if(1==e[24])for(t=0;t<21;t++)for(c=0,a=0;a<4;a++){let e=h[t][a];if(e<0)break;if(u[e])if(A=w[e],1==A.nFaces){for(o=24;o>0;o--)if(u[e]&1<<o){if(c&&24!=o)break;if(24!=o){if(r[w[h[t][1-a]].nPips-1]>1)break;c=1}I[t].nChequers++,o-A.nPips+1>I[t].nPips&&(I[t].nPips=o-A.nPips+1)}}else{if(!(u[e]&1<<24))continue;for(I[t].nChequers||(I[t].nChequers=1),25-A.nPips>I[t].nPips&&(I[t].nPips=25-A.nPips),o=0;o<3&&A.anIntermediate[o]>0;o++)if(1==r[A.anIntermediate[o]+1]){I[t].nChequers++;break}}}else for(t=0;t<21;t++)for(a=0;a<2;a++){let e=h[t][a];u[e]&1<<24&&(A=w+e,1==A.nFaces&&(I[t].nChequers++,25-A.nPips>I[t].nPips&&(I[t].nPips=25-A.nPips)))}else for(t=0;t<21;t++)for(c=-1,a=0;a<4;a++){let n=h[t][a];if(n<0)break;if(u[n])if(A=w[n],1==A.nFaces)o=mn(u[n]),(c!=o||e[o]>1)&&I[t].nChequers++,c=o,o-A.nPips+1>I[t].nPips&&(I[t].nPips=o-A.nPips+1),h[t][3]>=0&&u[n]&~(1<<o)&&I[t].nChequers++;else for(I[t].nChequers||(I[t].nChequers=1),o=mn(u[n]),o-A.nPips+1>I[t].nPips&&(I[t].nPips=o-A.nPips+1),s=0;s<3&&A.anIntermediate[s]>0;s++)if(1==r[23-o+A.anIntermediate[s]]){I[t].nChequers++;break}}{let e,r=0,a=0,o=0;for(t=0;t<6;t++)e=I[t].nChequers,r+=I[t].nPips,e>0&&(a+=1,e>1&&(o+=1));for(;t<21;t++)e=I[t].nChequers,r+=2*I[t].nPips,e>0&&(a+=2,e>1&&(o+=2));n[Ee]=r/432,n[Fe]=a/36,n[ke]=o/36}for(n[Re]=gn(e,23-i)/36,n[Xe]=function(e,r){let n,t,a=0;for(t=r<12?r:12,n=0;n<t;n++)a|=Vr[e[24+n-r]]<<n;return Hr[a]}(e,23-i)/36,c=36,t=15;t<24-i;t++)(a=gn(e,t))<c&&(c=a);for(n[Ne]=(36-c)/36,n[_e]=n[Ne]*n[Ne],i<0&&(t=15,c=36);t<24;t++)(a=gn(e,t))<c&&(c=a);for(n[We]=(36-c)/36,n[He]=n[We]*n[We],c=0,t=6;t<25;t++)e[t]&&(c+=(t-5)*e[t]*gn(r,t));for(n[Ve]=c/3600,a=0,c=0,t=0;t<25;t++){let r=e[t];r&&(a+=r,c+=t*r)}for(a&&(c=(c+a-1)/a),a=0,o=0,t=c+1;t<25;t++){let r=e[t];r&&(a+=r,o+=r*(t-c)*(t-c))}if(a&&(o=(o+a-1)/a),n[Ge]=o/400,e[24]>0){let o=0,s=e[24]>1;for(t=0;t<6;++t)if(r[t]>1)for(o+=4*(t+1),a=t+1;a<6;++a)r[a]>1?o+=2*(t+a+2):s&&(o+=2*(t+1));else if(s)for(a=t+1;a<6;++a)r[a]>1&&(o+=2*(a+1));n[je]=o/294}else n[je]=0;for(c=0,t=0;t<6;t++)c+=r[t]>1;n[Ue]=(36-(c-6)*(c-6))/36;{let r,t=-1,a=0,o=0;for(r=23;r>0;--r)if(e[r]>=2){if(-1==t){t=r;continue}{let n=t-r;a+=new Int32Array([11,11,11,11,11,11,11,6,5,4,3,2,0,0,0,0,0,0,0,0,0,0,0])[n]*e[t],o+=e[t]}}n[qe]=o?1-a/(11*o):0}{let r=0;for(t=18;t<24;++t)e[t]>1&&++r;if(n[Ye]=0,n[Ke]=0,r>=1){let a=0;for(t=18;t<25;++t)a+=e[t];r>1?n[Ye]=(a-3)/4:1==r&&(n[Ke]=a/8)}}}function Ur(e,r){let n,t=15;for(n=0;n<25;n++)t-=e[n];t<=5?(r[0]=t?t/5:0,r[1]=0,r[2]=0):t<=10?(r[0]=1,r[1]=(t-5)/5,r[2]=0):(r[0]=1,r[1]=1,r[2]=(t-10)/5)}function zr(e,r){let n,t=15;for(n=0;n<25;++n)t-=e[n];t<=2?(r[0]=t?t/3:0,r[1]=0,r[2]=0):t<=5?(r[0]=1,r[1]=(t-3)/3,r[2]=0):(r[0]=1,r[1]=1,r[2]=(t-6)/3)}function qr(e,r,n,t,a,o,s,i,c){let l,u,f,y,A=0,w=!1;if(hn(e,t,r,n,!1),0==e.cMoves)return e.amMoves=null,0;u=e.cMoves,f=i.nPlies>0&&i.nPlies<=Be?c[i.nPlies-1]:c[Be-1];const h={Accept:0,Extra:0,Threshold:0};for(let r=0;r<i.nPlies;r++){const n=r<Be?f[r]:h;let t;if(!(n.Accept<0)){if(An(e,s,i,r)<0)return e.cMoves=0,e.amMoves=null,-1;e.amMoves.sort(wn),e.iMoveBest=0,t=e.cMoves,e.cMoves=Math.min(n.Accept,e.cMoves);{let r=Math.min(t,e.cMoves+n.Extra);for(;e.cMoves<r&&!(e.amMoves[e.cMoves].rScore<e.amMoves[0].rScore-n.Threshold);++e.cMoves);}if(A=r,1==e.cMoves&&1!=n.Accept){w=!0;break}}}if(!w){if(An(e,s,i,i.nPlies)<0)return e.cMoves=0,e.amMoves=null,-1;A=i.nPlies,e.amMoves.sort(wn),e.iMoveBest=0}if(y=e.cMoves,e.cMoves=u,a){let r=!1;for(l=0;l<e.cMoves;l++)if(j(a,e.amMoves[l].key)){if(e.amMoves[l].esMove.ec.nPlies<A&&(Jr(null,e.amMoves[l],s,i,A),r=!0),Math.abs(e.amMoves[l].rScore-e.amMoves[0].rScore)>o&&A<i.nPlies&&(Jr(null,e.amMoves[0],s,i,i.nPlies),Jr(null,e.amMoves[l],s,i,i.nPlies),y=1,r=!0),r&&i.nPlies){let r,n;for(r=e.amMoves[l],n=l-1;n>=y;--n)e.amMoves[n+1]=e.amMoves[n];e.amMoves[y]=r,e.amMoves.sort(wn)}break}}return 0}function Yr(e,r,n,t,a,o,s){let i,c,l={cMoves:0,cMaxMoves:0,cMaxPips:0,iMoveBest:0,rBestScore:0,amMoves:null},u=A.CLASS_OVER,f=new Uint32Array(ar);if(hn(l,t,r,n,!1),0==l.cMoves)return;if(1==l.cMoves)return l.iMoveBest=0,void V(a,l.amMoves[l.iMoveBest].key);if(c=tr+Cn(l.cMoves),l.cMoves<=c)return An(l,o,s,0),void V(a,l.amMoves[l.iMoveBest].key);o.fMove=1-o.fMove;const y=new Float32Array($e),w=new Float32Array(ge);for(i=0;i<l.cMoves;i++){let r,n,t=Ie(),s=l.amMoves[i];if(G(a,s.key),r=Zr(a,Me),0==i){if(r<A.CLASS_RACE)break;u=r}else if(r!=u)break;if(Mn(s.key,t.key),t.nEvalContext=0,(n=Ae(Cr,t,w))!=ue){pe(a,y);{const n=[Nr,_r,Rr][r-A.CLASS_RACE];e&&(e[r-A.CLASS_RACE].state=0==i?ne:te),oe(n,y,w,e),r==A.CLASS_RACE&&On(a,w),Qr(a,w)}t.ar.set(w),t.ar[5]=0,we(Cr,t,n)}if(s.rScore=ln(w,o),i<c)f[i]=i,s.rScore>l.amMoves[f[0]].rScore&&(f[i]=f[0],f[0]=i);else if(s.rScore<l.amMoves[f[0]].rScore){let e,r=0;for(f[0]=i,e=1;e<c;++e)l.amMoves[f[e]].rScore>l.amMoves[f[r]].rScore&&(r=e);f[0]=f[r],f[r]=i}}o.fMove=1-o.fMove,i==l.cMoves?function(e,r,n,t,a){let o,s,i=0,c=gr;for(e.rBestScore=-99999.9,c[0].state=c[1].state=c[2].state=ne,s=0;s<a;s++){if(o=t[s],Jr(c,e.amMoves[o],r,n,0)<0){i=-1;break}(e.amMoves[o].rScore>e.rBestScore||e.amMoves[o].rScore==e.rBestScore&&e.amMoves[o].rScore2>e.amMoves[e.iMoveBest].rScore2)&&(e.iMoveBest=o,e.rBestScore=e.amMoves[o].rScore)}c[0].state=c[1].state=c[2].state=re}(l,o,s,f,c):An(l,o,s,0),V(a,l.amMoves[l.iMoveBest].key)}function Kr(e,r,n,t,a,o,s,i){const c=Object.clone(o),l={cMoves:0,cMaxMoves:0,cMaxPips:0,iMoveBest:0,rBestScore:0,amMoves:null};let u;if(c.nPlies=s,e)for(u=0;u<8;++u)e[u]=-1;if(qr(l,r,n,t,null,0,a,c,i)<0)return-1;if(e)for(u=0;u<2*l.cMaxMoves;u++)e[u]=l.amMoves[l.iMoveBest].anMove[u];return l.cMoves&&V(t,l.amMoves[l.iMoveBest].key),2*l.cMaxMoves}function Jr(e,r,n,t,a){var o=v(),s=new Float32Array(7),i=Object.clone(n);return G(o,r.key),i.fMove=1-i.fMove,function(e,r,n,t,a,o){if(a.fCubeful){if(function(e,r,n,t,a,o){let s=[0];return rn(e,n,r,s,[t],1,t,a,o,!1)?-1:(r[Te]=ln(r,t),r[Pe]=s[0],0)}(e,r,n,t,a,o))return-1}else{if(tn(e,n,r,t,a,o,Zr(n,t.bgv)))return-1;r[Te]=ln(r,t),r[Pe]=0}return 0}(e,s,o,i,t,a)?-1:(function(e,r){(function(e){let r;e[Qe]=1-e[Qe],r=e[Ze],e[Ze]=e[er],e[er]=r,r=e[rr],e[rr]=e[nr],e[nr]=r})(e),e[Te]=-e[Te],r.nMatchTo?e[Pe]=1-e[Pe]:e[Pe]=-e[Pe]}(s,i),i.nMatchTo&&(s[Pe]=function(e,r){var n,t;return(2*e-((n=un(r.anScore[0],r.anScore[1],r.nMatchTo,r.fMove,r.nCube,r.fMove,r.fCrawford,aafMET,aafMETPostCrawford))+(t=un(r.anScore[0],r.anScore[1],r.nMatchTo,r.fMove,r.nCube,1-r.fMove,r.fCrawford,aafMET,aafMETPostCrawford))))/(n-t)}(s[Pe],i)),r.arEvalMove=s,r.esMove.et=f.EVAL_EVAL,r.esMove.ec=Object.clone(t),r.esMove.ec.nPlies=a,r.rScore=t.fCubeful?s[Pe]:s[Te],r.rScore2=s[Te],0)}function Xr(e){let r,n;for(r=0;r<25;r++)n=e[0][r],e[0][r]=e[1][r],e[1][r]=n}function $r(e){let r,n=[];for(X(Or,e,null,null,null,n,null),r=31;r>=0;r--)if(n[r])return r;return-1}function Qr(e,r){var n,t,a,o,s=[0,0],i=[0,0],c=[0,0],l=[1,1],u=[0,0];for(t=0;t<2;t++){for(n=0,a=0;n<6;n++)e[t][n]&&(i[t]=n,a+=e[t][n]);for(s[t]=c[t]=a,n=6,a=0;n<12;n++)e[t][n]&&(i[t]=n,a+=e[t][n]);for(s[t]+=a,c[t]+=2*a,l[t]+=a,n=12,a=0;n<18;n++)e[t][n]&&(i[t]=n,a+=e[t][n]);for(s[t]+=a,c[t]+=3*a,l[t]+=2*a,n=18,a=0;n<24;n++)e[t][n]&&(i[t]=n,a+=e[t][n]);s[t]+=a,c[t]+=4*a,l[t]+=3*a,e[t][24]&&(i[t]=24,s[t]+=e[t][24],c[t]+=5*e[t][24],l[t]+=4*e[t][24])}if(!(o=i[0]+i[1]>=24)){for(n=0;n<2;n++)i[n]<6&&Or?u[n]=$r(W(e[n],Or.nPoints,Or.nChequers)):u[n]=2*c[n];u[1]||(u[1]=1)}!o&&c[0]>4*(u[1]-1)&&(r[Qe]=1),s[0]<15?r[Ze]=r[rr]=0:o||(c[1]>8*l[0]?r[Ze]=0:l[0]>4*(u[1]-1)&&(r[Ze]=1),i[0]<18&&(r[rr]=0)),!o&&c[1]>4*u[0]&&(r[Qe]=0),s[1]<15?r[er]=r[nr]=0:o||(c[0]>8*l[1]-4?r[er]=0:l[1]>4*u[0]&&(r[er]=1),i[1]<18&&(r[nr]=0)),r[Ze]>r[Qe]&&(r[Ze]=r[Qe]);{let e=1-r[Qe];r[er]>e&&(r[er]=e)}if(r[rr]>r[Ze]&&(r[rr]=r[Ze]),r[nr]>r[er]&&(r[nr]=r[er]),o){let e=1e-4;for(n=Ze;n<ge;++n)r[n]<e&&(r[n]=0)}}function Zr(e,r){let n=-1,t=-1;for(n=24;n>=0&&!e[0][n];--n);for(t=24;t>=0&&!e[1][t];--t);if(t<0||n<0)return A.CLASS_OVER;switch(r){case be:return A.CLASS_HYPERGAMMON1;case Ce:return A.CLASS_HYPERGAMMON2;case me:return A.CLASS_HYPERGAMMON3;case Me:case Se:if(t+n>22){const r=6;for(let n=0;n<2;++n){let t=0;const a=e[n];for(let e=0;e<25;++e)t+=a[e];if(t<=r)return A.CLASS_CRASHED;if(a[0]>1){if(t<=r+a[0])return A.CLASS_CRASHED;if(1+t-(a[0]+a[1])<=r&&a[1]>1)return A.CLASS_CRASHED}else if(t<=r+(a[1]-1))return A.CLASS_CRASHED}return A.CLASS_CONTACT}return A.CLASS_RACE}return A.CLASS_OVER}function en(e,r,n,t,a,o,s,i,c,l){let u,f,y,w,h,I=new Float32Array(ge).fill(0),d=new Float32Array(4).fill(0);const M=p();let S,b,C,m=new Float32Array(2*o),g=new Float32Array(2*o),B=function(e,r){const n=new Array(e);for(let t=0;t<e;++t)n[t]=r();return n}(2*o,p);if(y=Zr(r,s.bgv),!(y>A.CLASS_OVER&&c>0)||y<=fr&&!s.nMatchTo){if(y==A.CLASS_HYPERGAMMON1||y==A.CLASS_HYPERGAMMON2||y==A.CLASS_HYPERGAMMON3);else if(y>A.CLASS_OVER&&y<=fr){if(function(e,r,n){switch(Zr(e,n)){case A.CLASS_BEAROFF2:return an(pbc2,e,r);case A.CLASS_BEAROFF_TS:return an(pbcTS,e,r)}return-1}(r,d,s.bgv))return-1;n[Qe]=(d[0]+1)/2,n[Ze]=n[rr]=n[er]=n[nr]=0}else{if(function(e,r,n,t,a){const o=Zr(r,t.bgv);return tn(e,r,n,t,Br,0,o)}(e,r,n,s))return-1;if(i.rNoise>0&&y!=A.CLASS_OVER)for(u=0;u<ge;u++)n[u]+=Sn(pec,r,u),n[u]=Math.max(n[u],0),n[u]=Math,min(n[u],1);(y>yr||i.rNoise>0)&&Qr(r,n)}for(h=function(e,r){switch(r){case A.CLASS_OVER:return 0;case A.CLASS_HYPERGAMMON1:case A.CLASS_HYPERGAMMON2:case A.CLASS_HYPERGAMMON3:return.6;case A.CLASS_BEAROFF1:case A.CLASS_BEAROFF_OS:return hr;case A.CLASS_RACE:{const r=new Uint32Array(2).fill(0);!function(e,r){r[0]=0,r[1]=0;for(let n=0;n<25;n++)r[0]+=e[0][n]*(n+1),r[1]+=e[1][n]*(n+1)}(e,r);let n=r[1]*Ir+dr;return n>vr?vr:n<pr?pr:n}case A.CLASS_CONTACT:return Sr;case A.CLASS_CRASHED:return Mr;case A.CLASS_BEAROFF2:case A.CLASS_BEAROFF_TS:return wr}return 0}(r,y),Ln(a,o,l,B,!1),f=0;f<2*o;f++)if(B[f].nCube>0)if(B[f].nMatchTo)switch(y){case A.CLASS_HYPERGAMMON1:case A.CLASS_HYPERGAMMON2:case A.CLASS_HYPERGAMMON3:case A.CLASS_BEAROFF2:case A.CLASS_BEAROFF_TS:console.error("Not implemented");break;case A.CLASS_OVER:case A.CLASS_RACE:case A.CLASS_CRASHED:case A.CLASS_CONTACT:case A.CLASS_BEAROFF1:case A.CLASS_BEAROFF_OS:m[f]=sn(n,B[f],h)}else switch(y){case A.CLASS_HYPERGAMMON1:case A.CLASS_HYPERGAMMON2:case A.CLASS_HYPERGAMMON3:m[f]=CFHYPER(d,B[f]);break;case A.CLASS_BEAROFF2:case A.CLASS_BEAROFF_TS:m[f]=CFMONEY(d,B[f]);break;case A.CLASS_OVER:case A.CLASS_RACE:case A.CLASS_CRASHED:case A.CLASS_CONTACT:case A.CLASS_BEAROFF1:case A.CLASS_BEAROFF_OS:m[f]=on(n,B[f],h)}Bn(t,o,m,B)}else{const f=v(),y=i.fUsePrune&&0==i.rNoise&&s.bgv==Me;for(u=0;u<ge;u++)n[u]=0;for(u=0;u<2*o;u++)m[u]=0;for(Ln(a,o,l,B,!0),b=1;b<=6;b++)for(C=1;C<=b;C++){for(S=b==C?1:2,u=0;u<25;u++)f[0][u]=r[0][u],f[1][u]=r[1][u];if(y?Yr(e,b,C,r,f,s,i):Kr(null,b,C,f,s,i,0,Tr),Xr(f),Gr(M,s.nCube,s.fCubeOwner,1-s.fMove,s.nMatchTo,s.anScore,s.fCrawford,s.fJacoby,s.fBeavers,s.bgv),rn(e,f,I,g,B,2*o,M,i,c-1,!1))return-1;for(u=0;u<ge;u++)n[u]+=S*I[u];for(u=0;u<2*o;u++)m[u]+=S*g[u]}const A=36;for(n[Qe]=1-n[Qe]/A,w=n[Ze]/A,n[Ze]=n[er]/A,n[er]=w,w=n[rr]/A,n[rr]=n[nr]/A,n[nr]=w,u=0;u<2*o;u++)s.nMatchTo?m[u]=1-m[u]/A:m[u]=-m[u]/A;for(u=0;u<2*o;u++)B[u].fMove=1-B[u].fMove;Bn(t,o,m,B)}return 0}function rn(e,r,n,t,a,o,s,i,c,l){var u,f=!0,y=Ie();if(!Ar||0!=i.rNoise)return en(e,r,n,t,a,o,s,i,c,l);for(H(r,y.key),f=!l,u=0;u<o&&f;++u)a[u].nCube<0||(y.nEvalContext=bn(i,c,a[u],!0),Ae(br,y,n,t[u])!=ue&&(f=!1));if(!f){if(en(e,r,n,t,a,o,s,i,c,l))return-1;if(!l)for(u=0;u<o;++u)a[u].nCube<0||(y.ar.set(n.subarray(0,ge)),y.ar[ge]=t[u],y.nEvalContext=bn(i,c,a[u],!0),we(br,y,fe(br.hashMask,y)))}return 0}function nn(e,r,n,t,a,o,s){let i,c,l,u,f=new Float32Array(5);if(s>fr&&o>0){let s=v(),y=p();const A=a.fUsePrune&&0==a.rNoise&&t.bgv==Me;for(i=0;i<ge;i++)n[i]=0;for(c=1;c<=6;c++)for(l=1;l<=c;l++){for(u=c==l?1:2,i=0;i<25;i++)s[0][i]=r[0][i],s[1][i]=r[1][i];if(A?Yr(e,c,l,r,s,t,a):Kr(null,c,l,s,t,a,0,Tr),Xr(s),Gr(y,t.nCube,t.fCubeOwner,1-t.fMove,t.nMatchTo,t.anScore,t.fCrawford,t.fJacoby,t.fBeavers,t.bgv),tn(e,s,f,y,pec,o-1,Zr(s,y.bgv)))return-1;for(i=0;i<ge;i++)n[i]+=u*f[i]}for(i=0;i<ge;i++)n[i]/=36;n[Qe]=1-n[Qe],rTemp=n[Ze],n[Ze]=n[er],n[er]=rTemp,rTemp=n[rr],n[rr]=n[nr],n[nr]=rTemp}else{if(Pr[s](r,n,t.bgv,e))return-1;if(a.rNoise>0&&s!=A.CLASS_OVER)for(i=0;i<ge;i++)n[i]+=Sn(pec,r,i),n[i]=Math.max(n[i],0),n[i]=Math.min(n[i],1);(s>yr||a.rNoise>0)&&Qr(r,n)}return 0}function tn(e,r,n,t,a,o,s){let i,c={key:M(),nEvalContext:0,ar:new Float32Array(6)};return Ar&&0==a.rNoise?(H(r,c.key),c.nEvalContext=bn(a,o,t,!1),(i=Ae(br,c,n))==ue?0:nn(e,r,n,t,a,o,s)?-1:(c.ar=new Float32Array(n),c.ar[5]=0,we(br,c,i),0)):nn(e,r,n,t,a,o,s)}function an(e,r,n){let t=W(r[1],e.nPoints,e.nChequers),a=W(r[0],e.nPoints,e.nChequers),o=Combination(e.nPoints+e.nChequers,e.nPoints);return BearoffCubeful(pbc,t*o+a,n,NULL)}function on(e,r,n){let t,a,o,s;return e[Qe]>1e-7?(t=1+(e[Ze]+e[rr])/e[Qe],e[Qe]<.9999999?(a=1+(e[er]+e[nr])/(1-e[Qe]),o=cn(e,r),s=function(e,r,n,t){if(-1==t.fCubeOwner){let a=(r-.5)/(e+r+.5),o=(r+1)/(e+r+.5);return n<a?t.fJacoby?-1:(-1+r)*n/a-r:n<o?2*(n-a)/(o-a)-1:t.fJacoby?1:1+(e-1)*(n-o)/(1-o)}if(t.fCubeOwner==t.fMove){let t=(r+1)/(e+r+.5);return n<t?(1+r)*n/t-r:1+(e-1)*(n-t)/(1-t)}{let t=(r-.5)/(e+r+.5);return n<t?(-1+r)*n/t-r:(e+1)*(n-t)/(1-t)-1}}(t,a,e[Qe],r),o*(1-n)+s*n):cn(e,r)):cn(e,r)}function sn(e,r,n){return function(e){return!(e.anScore[0]+e.nCube>=e.nMatchTo&&e.anScore[1]+e.nCube>=e.nMatchTo||e.anScore[0]==e.nMatchTo-2&&e.anScore[1]==e.nMatchTo-2||e.fCrawford)}(r)?-1==r.fCubeOwner?function(e,r,n){let t,a,o,s,i,c,l,u,f,y,A,w,I=new Float32Array(2),d=[new Float32Array(h.DTLBP1+1),new Float32Array(h.DTLBP1+1)];return e[Qe]>0?(t=(e[Ze]-e[rr])/e[Qe],a=e[rr]/e[Qe]):(t=0,a=0),e[Qe]<1?(o=(e[er]-e[nr])/(1-e[Qe]),s=e[nr]/(1-e[Qe])):(o=0,s=0),i=yn(cn(e,r),r),xn(e,r,I),fn(r.anScore[0],r.anScore[1],r.nMatchTo,r.nCube,-1,-1,r.fCrawford,aafMET,aafMETPostCrawford,d[0],d[1]),y=d[r.fMove][h.NDW],f=d[r.fMove][h.NDL],A=1-I[1-r.fMove],w=I[r.fMove],e[Qe]<=A?(u=(1-o-s)*d[r.fMove][h.NDL]+o*d[r.fMove][h.NDLG]+s*d[r.fMove][h.NDLB],c=A>0?u+(f-u)*e[Qe]/A:u,i*(1-n)+c*n):e[Qe]<w?(c=f+(y-f)*(e[Qe]-A)/(w-A),i*(1-n)+c*n):(l=(1-t-a)*d[r.fMove][h.NDW]+t*d[r.fMove][h.NDWG]+a*d[r.fMove][h.NDWB],c=w<1?y+(l-y)*(e[Qe]-w)/(1-w):l,i*(1-n)+c*n)}(e,r,n):r.fCubeOwner==r.fMove?function(e,r,n){let t,a,o,s,i,c,l,u,f,y,A=new Float32Array(2),w=[new Float32Array(h.DTLBP1+1),new Float32Array(h.DTLBP1+1)];return e[Qe]>0?(t=(e[Ze]-e[rr])/e[Qe],a=e[rr]/e[Qe]):(t=0,a=0),e[Qe]<1?(o=(e[er]-e[nr])/(1-e[Qe]),s=e[nr]/(1-e[Qe])):(o=0,s=0),i=yn(cn(e,r),r),xn(e,r,A),fn(r.anScore[0],r.anScore[1],r.nMatchTo,r.nCube,-1,-1,r.fCrawford,aafMET,aafMETPostCrawford,w[0],w[1]),f=w[r.fMove][h.NDW],y=A[r.fMove],e[Qe]<=y?(u=(1-o-s)*w[r.fMove][h.NDL]+o*w[r.fMove][h.NDLG]+s*w[r.fMove][h.NDLB],c=y>0?u+(f-u)*e[Qe]/y:u,i*(1-n)+c*n):(l=(1-t-a)*w[r.fMove][h.NDW]+t*w[r.fMove][h.NDWG]+a*w[r.fMove][h.NDWB],c=y<1?f+(l-f)*(e[Qe]-y)/(1-y):l,i*(1-n)+c*n)}(e,r,n):function(e,r,n){let t,a,o,s,i,c,l,u,f,y,A=new Float32Array(2),w=[new Float32Array(h.DTLBP1+1),new Float32Array(h.DTLBP1+1)];return e[Qe]>0?(t=(e[Ze]-e[rr])/e[Qe],a=e[rr]/e[Qe]):(t=0,a=0),e[Qe]<1?(o=(e[er]-e[nr])/(1-e[Qe]),s=e[nr]/(1-e[Qe])):(o=0,s=0),i=yn(cn(e,r),r),xn(e,r,A),fn(r.anScore[0],r.anScore[1],r.nMatchTo,r.nCube,-1,-1,r.fCrawford,aafMET,aafMETPostCrawford,w[0],w[1]),f=w[r.fMove][h.NDL],y=1-A[1-r.fMove],e[Qe]<=y?(u=(1-o-s)*w[r.fMove][h.NDL]+o*w[r.fMove][h.NDLG]+s*w[r.fMove][h.NDLB],c=y>0?u+(f-u)*e[Qe]/y:u,i*(1-n)+c*n):(l=(1-t-a)*w[r.fMove][h.NDW]+t*w[r.fMove][h.NDWG]+a*w[r.fMove][h.NDWB],c=f+(l-f)*(e[Qe]-y)/(1-y),i*(1-n)+c*n)}(e,r,n):yn(cn(e,r),r)}function cn(e,r){return r.nMatchTo?2*e[Qe]-1+e[Ze]*r.arGammonPrice[r.fMove]-e[er]*r.arGammonPrice[1-r.fMove]+e[rr]*r.arGammonPrice[2+r.fMove]-e[nr]*r.arGammonPrice[3-r.fMove]:2*e[Qe]-1+(e[Ze]-e[er])*r.arGammonPrice[0]+(e[rr]-e[nr])*r.arGammonPrice[1]}function ln(e,r){return r.nMatchTo?cn(e,r):2*e[Qe]-1+(e[Ze]-e[er])+(e[rr]-e[nr])}function un(e,r,n,t,a,o,s,i,c){var l=n-(e+!o*a)-1,u=n-(r+o*a)-1;return l<0?t?0:1:u<0?t?1:0:s||n-e==1||n-r==1?l?t?1-c[0][l]:c[0][l]:t?c[1][u]:1-c[1][u]:t?1-i[l][u]:i[l][u]}function fn(e,r,n,t,a,o,s,i,c,l=new Float32Array(30),u=new Float32Array(30)){let f,y,A,w,I,d,v,p,M,S,b,C,m=[new Int32Array(h.DTLBP1+1),new Int32Array(h.DTLBP1+1)],g=new Int32Array([1,2,3,4,6]),B=s;for(A=a<0?h.DTLB+1:o<0?h.DTLBP0+1:h.DTLBP1+1,d=m[0],v=m[1],b=n-e-1,C=n-r-1,B|=n-e==1||n-r==1,f=0,y=0;f<h.NDL;++f,++y)d[y]=b-g[f]*t,v[y]=C;for(f=0;f<h.NDL;++f,++y)d[y]=b,v[y]=C-g[f]*t;if(A>h.DPP0){for(f=0;f<h.NDL;++f,++y)d[y]=b-g[f]*a,v[y]=C;for(f=0;f<h.NDL;++f,++y)d[y]=b,v[y]=C-g[f]*a;if(A>h.DPP1){for(f=0;f<h.NDL;++f,++y)d[y]=b-g[f]*o,v[y]=C;for(f=0;f<h.NDL;++f,++y)d[y]=b,v[y]=C-g[f]*o}}for(f=0,p=0,M=0;f<A;++f)w=d[f],I=v[f],w<0?(l[p++]=1,u[M++]=0):I<0?(l[p++]=0,u[M++]=1):B?0==w?(l[p++]=1-c[1][I],u[M++]=c[1][I]):(l[p++]=c[0][w],u[M++]=1-c[0][w]):(l[p++]=i[w][I],u[M++]=1-i[w][I]);for(f=0,p=0,M=h.NDL;f<h.NDL;++f)S=u[p],u[p++]=u[M],u[M++]=S;if(A>h.DTLBP0)for(p+=h.NDL,M+=h.NDL,f=0;f<h.NDL;++f)S=u[p],u[p++]=u[M],u[M++]=S;if(A>h.DTLBP1)for(p+=h.NDL,M+=h.NDL,f=0;f<h.NDL;++f)S=u[p],u[p++]=u[M],u[M++]=S}function yn(e,r){let n,t;return n=un(r.anScore[0],r.anScore[1],r.nMatchTo,r.fMove,r.nCube,r.fMove,r.fCrawford,aafMET,aafMETPostCrawford),t=un(r.anScore[0],r.anScore[1],r.nMatchTo,r.fMove,r.nCube,1-r.fMove,r.fCrawford,aafMET,aafMETPostCrawford),.5*(e*(n-t)+(n+t))}function An(e,r,n,t){let a,o=0,s=gr;for(e.rBestScore=-99999.9,0==t&&(s[0].state=s[1].state=s[2].state=w.NNSTATE_INCREMENTAL),a=0;a<e.cMoves;a++){if(Jr(s,e.amMoves[a],r,n,t)<0){o=-1;break}(e.amMoves[a].rScore>e.rBestScore||e.amMoves[a].rScore==e.rBestScore&&e.amMoves[a].rScore2>e.amMoves[e.iMoveBest].rScore2)&&(e.iMoveBest=a,e.rBestScore=e.amMoves[a].rScore)}return 0==t&&(s[0].state=s[1].state=s[2].state=w.NNSTATE_NONE),o}function wn(e,r){return r.rScore>e.rScore||r.rScore==e.rScore&&r.rScore2>e.rScore2?1:-1}function hn(e,r,n,t,a){const o=new Int32Array(4),s=new Int32Array(8);return o[0]=n,o[1]=t,o[2]=o[3]=n==t?n:0,e.cMoves=e.cMaxMoves=e.cMaxPips=e.iMoveBest=0,e.amMoves=mr,dn(e,o,0,23,0,r,s,a),o[0]!=o[1]&&(o[0]=t,o[1]=n,dn(e,o,0,23,0,r,s,a)),e.amMoves=e.amMoves.slice(0,e.cMoves).map((e=>Object.clone(e))),e.cMoves}function In(e,r,n){let t;const a=r-n;if(a>=0)return e[0][23-a]<2;for(t=24;t>0&&!(e[1][t]>0);t--);return t<=5&&(r==t||-1==a)}function dn(e,r,n,t,a,o,s,i){let c,l=!1;if(n>3||!r[n])return!0;let u=v();if(o[1][24]){if(o[0][r[n]-1]>=2)return!0;for(s[2*n]=24,s[2*n+1]=24-r[n],c=0;c<25;c++)u[0][c]=o[0][c],u[1][c]=o[1][c];return vn(u,24,r[n],!0),dn(e,r,n+1,23,a+r[n],u,s,i)&&pn(e,n+1,a+r[n],s,u,i),i}for(c=t;c>=0;c--)o[1][c]&&In(o,c,r[n])&&(s[2*n]=c,s[2*n+1]=c-r[n],u=xr(o),vn(u,c,r[n],!0),dn(e,r,n+1,r[0]==r[1]?c:23,a+r[n],u,s,i)&&pn(e,n+1,a+r[n],s,u,i),l=1);return!l||i}function vn(e,r,n,t){const a=r-n;if(t&&(n<1||n>6))return-1;if(r<0||r>24||a>24||e[1][r]<1)return-1;if(e[1][r]--,a<0)return 0;if(e[0][23-a]){if(e[0][23-a]>1)return-1;e[1][a]=1,e[0][23-a]=0,e[0][24]++}else e[1][a]++;return 0}function pn(e,r,n,t,a,o){let s,i,c={anMove:new Uint8Array(8).fill(0),key:M(),cMoves:0,cPips:0,rScore:0,rScore2:0,arEvalMove:[],arEvalStdDev:[]};const l=M();if(o)r>e.cMaxMoves&&(e.cMaxMoves=r),n>e.cMaxPips&&(e.cMaxPips=n);else{if(r<e.cMaxMoves||n<e.cMaxPips)return;(r>e.cMaxMoves||n>e.cMaxPips)&&(e.cMoves=0),e.cMaxMoves=r,e.cMaxPips=n}for(c=e.amMoves[e.cMoves],H(a,l),s=0;s<e.cMoves;s++){const a=e.amMoves[s];if(j(l,a.key)){if(r>a.cMoves||n>a.cPips){for(i=0;i<2*r;i++)a.anMove[i]=t[i]>-1?t[i]:-1;r<4&&(a.anMove[2*r]=-1),a.cMoves=r,a.cPips=n}return}}for(s=0;s<2*r;s++)c.anMove[s]=t[s]>-1?t[s]:-1;for(r<4&&(c.anMove[2*r]=-1),Mn(l,c.key),c.cMoves=r,c.cPips=n,c.cmark=y.CMARK_NONE,s=0;s<ge;s++)c.arEvalMove[s]=0;e.cMoves++}function Mn(e,r){r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6]}function Sn(e,r,n){let t;if(e.fDeterministic){let e,a,o;for(o=0;o<25;o++)e[o<<1]=r[0][o],e[1+(o<<1)]=r[1][o];for(e[0]+=n,a=_(e,null,!0),t=0,o=0;o<16;o++)t+=a[o];t-=2040,t/=295.6}else{let e,r;do{e=4294967295*Math.random()*2/sr-1,r=4294967295*Math.random()*2/sr-1,t=e*e+r*r}while(t>1||0==t);t=r*Math.sqrt(-2*Math.log(t)/t)}return t*=e.rNoise,n==Ze||n==er?t*=.25:n!=rr&&n!=nr||(t*=.01),t}function bn(e,r,n,t){var a;return a=r|e.fCubeful<<4|n.fMove<<5,r&&(a^=e.fUsePrune<<6),(r||t)&&(n.nMatchTo?a^=n.nMatchTo-n.anScore[n.fMove]-1<<7^n.nMatchTo-n.anScore[1-n.fMove]-1<<13^Cn(n.nCube)<<19^(n.fCubeOwner<0?2:n.fCubeOwner==n.fMove)<<23^n.fCrawford<<25:(e.fCubeful||t)&&(a^=(n.fCubeOwner<0?2:n.fCubeOwner==n.fMove)<<23^n.fJacoby<<26^n.fBeavers<<27),t&&(a^=1783084158)),a}function Cn(e){let r=0;for(;e>>=1;)r++;return r}function mn(e){let r=0;const n=n=>{e>=1<<n&&(r+=n,e>>=n)};return n(16),n(8),n(4),n(2),n(1),r}function gn(e,r){let n,t,a=0;for(t=r<12?r:12,n=0;n<t;n++)a|=Vr[e[24+n-r]]<<n;return Wr[a]}function Bn(e,r,n,t){let a,o,s,i,c={rDP:0};for(o=0,a=0;o<r;o++,a+=2)t[a+1].nCube>0?(s=n[a],i=t[0].nMatchTo?n[a+1]:2*n[a+1],Tn(c,t[a]),e[o]=i>=s&&c.rDP>=s?i>=c.rDP?c.rDP:i:s):e[o]=n[a]}function Tn(e,r){let n,t;return r.nMatchTo?(t=!r.fCrawford&&(r.anScore[0]==r.nMatchTo-1||r.anScore[1]==r.nMatchTo-1),n=!r.fCrawford&&r.anScore[r.fMove]+r.nCube<r.nMatchTo&&!(t&&r.anScore[r.fMove]==r.nMatchTo-1)&&(-1==r.fCubeOwner||r.fCubeOwner==r.fMove),"rDPEq"in e&&(e.rDPEq=un(r.anScore[0],r.anScore[1],r.nMatchTo,r.fMove,r.nCube,r.fMove,r.fCrawford,aafMET,aafMETPostCrawford)),"fCube"in e&&(e.fCube=n)):("rDPEq"in e&&(e.rDPEq=1),n=-1==r.fCubeOwner||r.fCubeOwner==r.fMove,"fCube"in e&&(e.fCube=n)),n}function Pn(e,r,n){let t,a=0,o=0,s=v();for(t=0;t<6;++t)a+=e[r][t];for(t=22;t>=18;--t)o+=e[1-r][t]*(t-17);if(!((a+3)/4-(1==r?1:0)<=(o+2)/3))return 0;for(t=0;t<25;++t)s[r][t]=e[r][t];for(t=0;t<6;++t)s[1-r][t]=e[1-r][18+t];for(t=6;t<25;++t)s[1-r][t]=0;{let n=0,a=function(e){let r,n=0,t=0;for(r=4;r>=0;--r)e[r]&&(t+=1<<r),n+=e[r];if(n>6)return 0;{let r,n=0,a=new Uint32Array(6).fill(0);for(r=0;r<5;++r)t&1<<r&&(a[n]=e[r]-1,++n);return $[t-1][function(e,r){let n,t,a=e-1;for(n=0;n<e;n++)a+=r[n];for(t=1<<a,n=0;n<e-1;n++)a-=r[n]+1,t|=1<<a;return K(t,15,e)}(n,a)]}}(s[1-r]);if(a&&Or){let o,s=W(e[r],Or.nPoints,Or.nChequers),i=new Uint16Array(32),c=0==r?36:1;for(X(Or,s,null,null,null,i,null),o=1-r;o<or;o++){let e=0;for(c*=36,t=1;t<=o+r;++t)e+=i[t];n+=a[o]/c*e}n/=65535}else{let e=new Float32Array(5).fill(0);W(s[0],6,15)>923||W(s[1],6,15)>923?function(e,r,n,t){Or&&BearoffEval(Or,e,r)}(s,e):function(e,r,n,t){Lr&&BearoffEval(Lr,e,r)}(s,e),n=1==r?e[0]:1-e[0]}return Math.min(n,1)}}function On(e,r,n){let t,a=0,o=0,s=0;for(t=23;t>=0;--t)a+=e[0][t],o+=e[1][t];if(15==o&&(s|=lr),15==a&&(s|=ir),s){if(s&lr){for(t=23;t>=18&&!(e[1][t]>0);--t);t>=18&&(s|=ur)}if(s&ir){for(t=23;t>=18&&!(e[0][t]>0);--t);t>=18&&(s|=cr)}}if(s&(cr|ur)){let n=s&cr?1:0,t=Pn(e,n);t>0?1==n?(r[rr]=t,r[Ze]<r[rr]&&(r[Ze]=r[rr])):(r[nr]=t,r[er]<r[nr]&&(r[er]=r[nr])):1==n?r[rr]=0:r[nr]=0}}function Ln(e,r,n,t,a){let o,s;for(s=0,o=0;s<r;s++)e[s].nCube>0?Gr(t[o],e[s].nCube,e[s].fCubeOwner,a?1-e[s].fMove:e[s].fMove,e[s].nMatchTo,e[s].anScore,e[s].fCrawford,e[s].fJacoby,e[s].fBeavers,e[s].bgv):t[o].nCube=-1,o++,!n&&e[s].nCube>0&&Tn({},e[s])?Gr(t[o],2*e[s].nCube,1-e[s].fMove,a?1-e[s].fMove:e[s].fMove,e[s].nMatchTo,e[s].anScore,e[s].fCrawford,e[s].fJacoby,e[s].fBeavers,e[s].bgv):t[o].nCube=-1,o++}function Dn(e,r,n){return e<2*n&&r>=2*n?2*n:n}function xn(e,r,n){let t,a,o,s,i,c,l,u,f,y=r.nMatchTo-r.anScore[0]-1,A=r.nMatchTo-r.anScore[1]-1,w=r.nCube,I=[new Float32Array(MAXCUBELEVEL),new Float32Array(MAXCUBELEVEL)],d=[new Float32Array(MAXCUBELEVEL),new Float32Array(MAXCUBELEVEL)],v=new Float32Array(2),p=Float32Array(2),M=[new Float32Array(h.DTLBP1+1),new Float32Array(h.DTLBP1+1)];for(r.fMove?(e[Qe]>0?(v[1]=(e[Ze]-e[rr])/e[Qe],p[1]=e[rr]/e[Qe]):(v[1]=0,p[1]=0),e[Qe]<1?(v[0]=(e[er]-e[nr])/(1-e[Qe]),p[0]=e[nr]/(1-e[Qe])):(v[0]=0,p[0]=0)):(e[Qe]>0?(v[0]=(e[Ze]-e[rr])/e[Qe],p[0]=e[rr]/e[Qe]):(v[0]=0,p[0]=0),e[Qe]<1?(v[1]=(e[er]-e[nr])/(1-e[Qe]),p[1]=e[nr]/(1-e[Qe])):(v[1]=0,p[1]=0)),i=w,l=0;y>=2*i&&A>=2*i;)l++,i*=2;for(u=i,c=l;c>=0;u>>=1,c--)for(fn(r.anScore[0],r.anScore[1],r.nMatchTo,u,Dn(y,A,u),Dn(A,y,u),r.fCrawford,aafMET,aafMETPostCrawford,M[0],M[1]),f=0;f<2;f++)y<2*u||A<2*u?(s=(1-v[!f]-p[!f])*M[f][f?DTLP1:DTLP0]+v[!f]*M[f][f?DTLGP1:DTLGP0]+p[!f]*M[f][f?DTLBP1:DTLBP0],t=M[f][DP],o=(1-v[f]-p[f])*M[f][f?DTWP1:DTWP0]+v[f]*M[f][f?DTWGP1:DTWGP0]+p[f]*M[f][f?DTWBP1:DTWBP0],d[f][c]=(s-t)/(s-o),I[f][c]=d[f][c]):(a=M[f][DTL],t=M[f][DP],o=(1-v[f]-p[f])*M[f][DTW]+v[f]*M[f][DTWG]+p[f]*M[f][DTWB],I[f][c]=1-I[!f][c+1]*(t-o)/(a-o));return n[0]=I[0][0],n[1]=I[1][0],0}const En=[Fn(0),Fn(1)];function Fn(e){return{name:1==e?"gnubg":"user",pt:e,esChequer:b(),esCube:b(),aamf:m()}}function kn(e,r){const n={anBoard:v(!0),anDice:[0,0],fTurn:0,fResigned:0,fResignationDeclined:0,fDoubled:!1,cGames:0,fMove:0,fCubeOwner:-1,fCrawford:!1,fPostCrawford:!1,nMatchTo:0,anScore:[0,0],nCube:1,cBeavers:0,bgv:I,fCubeUse:!0,fJacoby:!0,gs:u};if(e&&(n.fTurn="black"==e?0:1),r){const e=n.anBoard[0],t=n.anBoard[1];e.fill(0),t.fill(0),e[24]=r[25],t[24]=-r[0];for(let n=1;n<25;++n)r[n]>0?e[n-1]=r[n]:r[n]<0&&(t[24-n]=-r[n]);Nn(n.anBoard)}return n}function Rn(e,r){console.debug("GAME move:",r);const n=e.anBoard[e.fTurn],t=e.anBoard[1-e.fTurn];for(const e of r){const[r,a]=[e[0],e[1]];n[r]--,n[a]++,t[23-a]&&(t[23-a]=0,t[24]++)}e.fTurn=1-e.fTurn,console.debug("AI play:",1-e.fTurn,"=>",e.fTurn),Nn(e.anBoard)}function Nn(e){console.log(function(e){const r=Array.from(e[1]),n=Array.from(e[0]);let t="+13-14-15-16-17-18------19-20-21-22-23-24-+\n";for(let e,a=0;a<6;++a){for(t+="|",e=11;e>=6;--e)t+=r[e]>a?" O ":n[23-e]>a?" X ":"   ";for(t+="| "+(n[24]>a?"X":" ")+" |";e>=0;--e)t+=r[e]>a?" O ":n[23-e]>a?" X ":"   ";t+="|\n"}t+="|                  |BAR|                  |\n";for(let e,a=5;a>=0;--a){for(t+="|",e=11;e>=6;--e)t+=r[23-e]>a?" O ":n[e]>a?" X ":"   ";for(t+="| "+(r[24]>a?"O":" ")+" |";e>=0;--e)t+=r[23-e]>a?" O ":n[e]>a?" X ":"   ";t+="|\n"}return t+="+12-11-10--9--8--7-------6--5--4--3--2--1-+\n",t}(e))}class _n{#M=new Wn;#S=kn();get turn(){return this.#S.fTurn?"AI":"HUMAN"}async init(){try{await this.#M.init();const{content:e}=await this.#M.get("data","gnubg.wd");console.debug("Content",e);!function(e,r=!0){ye(br,Ar),ye(Cr,65536),function(){let e,r,n,t;for(e=0;e<4096;e++){for(r=0,n=0;n<=5;n++)for(t=0;t<=n;t++)e&1<<n+t+1||e&1<<n&&e&1<<t||(r+=n==t?1:2);Wr[e]=r}}(),function(){let e,r,n,t,a;for(Hr[0]=0,e=1;e<4096;e++){for(r=0,a=0;!(e&1<<a);)++a;for(n=0;n<=5;n++)for(t=0;t<=n;t++)!(n+t+1>a)||e&1<<n+t+1||e&1<<n&&e&1<<t||(r+=n==t?1:2);Hr[e]=r}}(),console.groupCollapsed("Compute table"),console.debug(Wr[0],Wr[Wr.length-1]),console.debug(Hr[0],Hr[Hr.length-1]),console.groupEnd(),e.skip(8),se(Er,e),se(Fr,e),se(kr,e),se(Rr,e),se(Nr,e),se(_r,e)}(new Hn(e))}catch(e){console.error("Failed to load data",e)}}reset(e,r){this.#S=kn(e,r)}switchTurn(){const e=this.#S.fTurn;this.#S.fTurn=1-e,console.debug("AI switch turn",e,"=>",this.turn)}move(e,r=!1){if(r)return function(e,r){const n=p(),t={cMoves:0,cMaxMoves:0,cMaxPips:0,iMoveBest:0,rBestScore:0,amMoves:null};!function(e,r){Gr(e,r.nCube,r.fCubeOwner,r.fMove,r.nMatchTo,r.anScore,r.fCrawford,r.fJacoby,3,r.bgv)}(n,e);const a=En[e.fTurn].esChequer.ec,o=En[e.fTurn].aamf;if(qr(t,r[0],r[1],e.anBoard,null,0,n,a,o),console.debug("Moves:",t.cMoves,"Best move:",t.iMoveBest,"dices:",r),!t.amMoves)return[];const s=t.amMoves.slice(0,t.cMoves)[t.iMoveBest],i=Array.from(s.anMove.slice(0,2*s.cMoves)).flatMap(((e,r,n)=>r%2?[]:[n.slice(r,r+2)]));return console.log("AI move",i.map((e=>`${e[0]}/${e[1]}`))),Rn(e,i),i}(this.#S,e);Rn(this.#S,e)}reset(){this.#S=kn()}}class Wn extends e{get name(){return"backgammon"}async setup(){try{await async function(e,r){const n=await fetch(`/data/${r}`,{method:"GET",headers:{"Content-Type":"application/octet-stream"},responseType:"arraybuffer"}),t={id:r,content:await n.arrayBuffer()};console.debug("SETUP",t),await e.put("data",t)}(this,"gnubg.wd")}catch(e){console.error("Failed to pull data",e)}}onUpgrade(e,r,n){0===n&&Wn.addTable(e,"data")}}class Hn{static LE=!0;#b;#C=0;constructor(e){this.#b=new DataView(e)}readInt32(){const e=this.#b.getInt32(this.#C,Hn.LE);return this.#C+=4,e}readUint32(){const e=this.#b.getUint32(this.#C,Hn.LE);return this.#C+=4,e}readFloat32(){const e=this.#b.getFloat32(this.#C,Hn.LE);return this.#C+=4,e}readFloat32Array(e){e*=4;const r=this.#b.buffer.slice(this.#C,this.#C+e),n=new Float32Array(r);return this.#C+=e,n}skip(e){this.#C+=e}}var Vn,Gn,jn={onScreen:!1},Un={onScreen:!1},zn={onScreen:!1},qn={onScreen:!1};const Yn={position:"center",value:1,onScreen:!1},Kn={position:"",diceValueLeft:5,diceValueRight:5,onScreen:!1},Jn={reset:function(e="black"){const[r,n]=[0,1];this.p24=[2,r],this.p23=[0,-1],this.p22=[0,-1],this.p21=[0,-1],this.p20=[0,-1],this.p19=[5,n],this.p18=[0,-1],this.p17=[3,n],this.p16=[0,-1],this.p15=[0,-1],this.p14=[0,-1],this.p13=[5,r],this.p12=[5,n],this.p11=[0,-1],this.p10=[0,-1],this.p9=[0,-1],this.p8=[3,r],this.p7=[0,-1],this.p6=[5,r],this.p5=[0,-1],this.p4=[0,-1],this.p3=[0,-1],this.p2=[0,-1],this.p1=[2,n],this.offWhite=[0,n],this.offBlack=[0,r],this.barWhite=[0,n],this.barBlack=[0,r],this.status="start",this.onMove=e,this.moves=[],this.playedMoves=[],Yn.position="center",Yn.value=1,jn.onScreen=!1,Kn.onScreen=!1,Un.onScreen=!1,zn.onScreen=!1},save:function(){for(var e=1;e<=24;e++)this["b"+e]=this["p"+e].slice();this.bOffWhite=this.offWhite.slice(),this.bOffBlack=this.offBlack.slice(),this.bBarWhite=this.barWhite.slice(),this.bBarBlack=this.barBlack.slice(),this.bMoves=this.moves.slice()},undo:function(){for(var e=1;e<=24;e++)this["p"+e]=this["b"+e].slice();this.offWhite=this.bOffWhite.slice(),this.offBlack=this.bOffBlack.slice(),this.barWhite=this.bBarWhite.slice(),this.barBlack=this.bBarBlack.slice(),this.moves=this.bMoves.slice(),this.playedMoves=[]},mouseOverPoint:void 0},Xn=function(){function e(e,r){var n,t;if(n="b"==e.charAt(0)?"black"==Jn.onMove?25:0:parseInt(e.substr(1)),t="black"==Jn.onMove?n-r:n+r,"p"==(t="black"==Jn.onMove&&t<=0?"offBlack":"white"==Jn.onMove&&t>=25?"offWhite":"p"+t).charAt(0))return-1==Jn[t][1]||Jn[e][1]==Jn[t][1]||!(Jn[t][0]>1);for(var a="black"==Jn.onMove?0:1,o="black"==Jn.onMove?6:0,s=1+o;s<=18+o;s++)if(Jn["p"+s][1]==a)return!1;if(n==("black"==Jn.onMove?r:25-r))return!0;if("black"==Jn.onMove)for(s=n+1;s<=6;s++)if(Jn["p"+s][1]==a)return!1;if("white"==Jn.onMove)for(s=n-1;s>=19;s--)if(Jn["p"+s][1]==a)return!1;return!0}this.numOfValidMoves=function(){var e=0;for(var r in this)"object"==typeof this[r]&&(e+=this[r].length);return e},function(r){if(Jn["bar"+Jn.onMove.capitalizeFirstLetter()][0]>0){r["bar"+Jn.onMove.capitalizeFirstLetter()]=[];for(var n=0;n<Jn.moves.length;n++)e("bar"+Jn.onMove.capitalizeFirstLetter(),Jn.moves[n])&&-1==r["bar"+Jn.onMove.capitalizeFirstLetter()].indexOf(Jn.moves[n])&&r["bar"+Jn.onMove.capitalizeFirstLetter()].push(Jn.moves[n])}else for(n=1;n<=24;n++)if(Jn["p"+n][1]==("black"==Jn.onMove?0:1)){r["p"+n]=[];for(var t=0;t<Jn.moves.length;t++)e("p"+n,Jn.moves[t])&&-1==r["p"+n].indexOf(Jn.moves[t])&&r["p"+n].push(Jn.moves[t])}}(this)};class $n{static defaultOptions={onmove:function(){},undo:function(){},onover:function(){}};#m;#g=$n.defaultOptions;#B=600;#T=1;#P=[0,0];#O=1;#L=-1;#D=[];#x=[];#E="black";#F=new _n;get context(){return this.#m}get canvas(){return this.#m.canvas}get width(){return this.canvas.width}get height(){return this.canvas.height}get onmove(){return this.#F.board.getPlayingColor()}get waiting(){return this.#E!=this.onmove}get opponent(){return"black"==this.#E?"white":"black"}get turn(){return Jn.onMove}set level(e){this.#g.ai=e}constructor(e,r="black",n={}){e.onclick=e=>this.#k(e.offsetX,e.offsetY),Vn=e.getContext("2d"),this.#m=Vn,this.#E=r,Object.assign(this.#g,n),this.reset(r);const t=new ResizeObserver((e=>this.#R(e[0].contentRect)));t.observe(e)}async init(){await this.#F.init()}draw(){const e=Jn;var r,n,t,a,o,s;"black"==e.owner?(r="#333",n="#DDD",t="#333",a="#DDD",o="#DDD",s="#333"):(r="#DDD",n="#333",t="#DDD",a="#333",o="#333",s="#DDD");var i=this.#B,c=3*i/4,l=.02;function u(t,a){if(-1!=a[1]&&0!=a[0]){var o,s,u;o=0==a[1]?r:n;for(var y=Math.min(a[0],5),A=0;A<y;A++)t>=19?(s=i*l*(28.5+3*(t-19)),u=2*c*l+1.5*i*l+3*A*i*l):t>=13?(s=i*l*(6.5+3*(t-13)),u=2*c*l+1.5*i*l+3*A*i*l):t>=7?(s=i*l*(6.5+3*(12-t)),u=48*c*l-1.5*i*l-3*A*i*l):(s=i*l*(28.5+3*(6-t)),u=48*c*l-1.5*i*l-3*A*i*l),f(s,u,o,t==e.mouseOverPoint&&A==y-1&&"move"==e.status&&a[1]==("black"==e.onMove?0:1));a[0]>5&&(Vn.save(),Vn.fillStyle=o==r?n:r,Vn.font=i*l*1.8+"px Arial",Vn.textBaseline="middle",Vn.textAlign="center",Vn.fillText(a[0].toString(),s,u),Vn.restore())}}function f(e,r,n,t){t=t||!1;var a=i*l*1.5;Vn.save(),Vn.beginPath(),t&&(a*=1.05,Vn.shadowColor="#444",Vn.shadowBlur=5,Vn.shadowOffsetX=.2*a,Vn.shadowOffsetY=.2*a),Vn.arc(e,r,.99*a,0,2*Math.PI),Vn.fillStyle=n,Vn.fill(),Vn.restore(),Vn.stroke()}function y(r){r.onScreen=!0;var n=0==e.onMove,t=parseInt(.7*r.height).toString()+"px";Vn.save(),Vn.translate(r.x,r.y),Vn.rotate(n),Vn.translate(-r.width/2,-r.height/2),Vn.fillStyle=r.backgroundColor,Vn.strokeStyle=r.borderColor,Zn(Vn,0,0,r.width,r.height,c*l*.7,!0,!0),Vn.fillStyle=r.textColor,Vn.textBaseline="middle",Vn.textAlign="center",Vn.font="bold "+t+" Arial",Vn.fillText(r.text,r.width/2,r.height/2),Vn.restore()}function A(e,r,n,t,a){this.x=e,this.y=r,this.width=n,this.height=t,this.text=a,this.backgroundColor="#FCBD00",this.borderColor="#333",this.textColor="#FD3200",this.onScreen=!1}!function(){Vn.save(),Vn.fillStyle="#663300",Vn.fillRect(0,0,i,c),Vn.fillStyle="#B88A00",Vn.fillRect(i*l,c*l*2,i*l*3,c*l*20),Vn.fillRect(i*l,c*l*28,i*l*3,c*l*20),Vn.fillRect(i*l*46,c*l*2,i*l*3,c*l*20),Vn.fillRect(i*l*46,c*l*28,i*l*3,c*l*20),Vn.fillRect(i*l*5,c*l*2,i*l*18,c*l*46),Vn.fillRect(i*l*27,c*l*2,i*l*18,c*l*46);for(var e=0;e<=5;e++)r(5+3*e,2,3,20,e%2),r(5+3*e,48,3,20,(e+1)%2),r(27+3*e,2,3,20,e%2),r(27+3*e,48,3,20,(e+1)%2);function r(e,r,n,t,a){var o;Vn.save(),Vn.beginPath(),Vn.moveTo(i*l*e,c*l*r),o=r<25?r+t:r-t,Vn.lineTo(i*l*(e+n/2),c*l*o),Vn.lineTo(i*l*(e+n),c*l*r),Vn.fillStyle=0==a?"#ADAD85":"#FF471A",Vn.strokeStyle="#444",Vn.fill(),Vn.stroke(),Vn.restore()}Vn.restore()}(),function(e){Vn.save();const r=i/50,n=i/10,t=c-.7*r;Vn.fillStyle="#fff8",Vn.textBaseline="middle",Vn.textAlign="center",Vn.font=`bold ${r}px monospace`,Vn.fillText(e,n,t),Vn.restore()}(["w","w","w",".","s","i","p","m","e",".","i","o"].join("")),function(){for(var r=1;r<=24;r++)u(r,e["p"+r])}(),function(){for(var t=i*l*25,a=0;a<e.barBlack[0];a++)f(t,c*l*18-a*i*l*3,r,"barBlack"==e.mouseOver&&a==e.barBlack[0]-1&&"move"==e.status&&"black"==e.onMove);for(a=0;a<e.barWhite[0];a++)f(t,c*l*32+a*i*l*3,n,"barWhite"==e.mouseOver&&a==e.barWhite[0]-1&&"move"==e.status&&"white"==e.onMove)}(),function(){Vn.save(),Vn.fillStyle=r,Vn.lineWidth=2;for(var t=1;t<=e.offBlack[0];t++)Vn.fillRect(i*l*46,c*l*(48-4*t/3),i*l*3,c*l*4/3),Vn.strokeRect(i*l*46,c*l*(48-4*t/3),i*l*3,c*l*4/3);for(Vn.fillStyle=n,t=0;t<e.offWhite[0];t++)Vn.fillRect(i*l*46,c*l*(2+4*t/3),i*l*3,c*l*4/3),Vn.strokeRect(i*l*46,c*l*(2+4*t/3),i*l*3,c*l*4/3);Vn.restore()}(),function(e){if("off"!=e.position){e.x=i*l*2.5,e.y=c*l*25,e.angle=0,e.size=i*l*3*.95,e.fontsize=.7*e.size+"px";var r=1==e.value?"64":e.value.toString();"center"==e.position?e.angle=1.5*Math.PI:"black"==e.position?e.y=c*l*48-e.size/2:"white"==e.position?(e.y=c*l*2+e.size/2,e.angle=Math.PI):"right"==e.position?(e.x=i*l*36,e.angle=Math.PI):"left"==e.position&&(e.x=i*l*14),Vn.save(),Vn.fillStyle="#DDD",Vn.translate(e.x,e.y),Vn.rotate(e.angle),Vn.translate(-e.size/2,-e.size/2),Zn(Vn,0,0,e.size,e.size,.05*e.size,!0,!0),Vn.fillStyle="#333",Vn.font="bold "+e.fontsize+" Arial",Vn.textBaseline="middle",Vn.textAlign="center",Vn.fillText(r,e.size/2,e.size/2),Vn.restore(),e.onScreen=!0}}(Yn),function(){switch(e.status){case"roll":(jn=new A(0,c*l*25,i*l*6,c*l*3,"ROLL")).x="black"==e.onMove?i*l*36:i*l*14,y(jn);break;case"move":!function(){var r="black"==e.onMove?i*l*35.5-c*l*4:i*l*14.5,n=c*l*23;Kn.position="black"==e.onMove?"right":"left";var u="black"==e.onMove?t:o,f="black"==e.onMove?a:s;function y(e,r,n,t,a,o,s){const i=[];e.save(),e.fillStyle=o,e.translate(r,n),Zn(e,0,0,t,t,.1*t,!0,!1);var c,l=.25;r=l*t,n=l*t,i.push({x:r,y:n}),n=.5*t,i.push({x:r,y:n}),n=.75*t,i.push({x:r,y:n}),r=.5*t,n=.5*t,i.push({x:r,y:n}),r=.75*t,n=l*t,i.push({x:r,y:n}),n=.5*t,i.push({x:r,y:n}),n=.75*t,i.push({x:r,y:n}),1==a?c=[3]:2==a?c=[0,6]:3==a?c=[0,3,6]:4==a?c=[0,2,4,6]:5==a?c=[0,2,3,4,6]:6==a?c=[0,1,2,4,5,6]:console.log("Dice value shall be between 1 and 6"),e.fillStyle=s;for(var u=0;u<c.length;u++){e.beginPath();var f=c[u];e.arc(i[f].x,i[f].y,.07*t,0,2*Math.PI),e.fill()}e.restore()}y(Vn,r,n,c*l*4,Kn.diceValueLeft,u,f),r="black"==e.onMove?r+c*l*4+i*l:r-c*l*4-i*l,y(Vn,r,n,c*l*4,Kn.diceValueRight,u,f),Kn.onScreen=!0}();break;case"accept":Un=new A(0,c*l*25,i*l*6,c*l*3,"TAKE"),zn=new A(0,c*l*25,i*l*6,c*l*3,"PASS"),Un.x="black"==e.onMove?i*l*36-Un.width/2-i*l/2:i*l*14+Un.width/2+i*l/2,zn.x="black"==e.onMove?i*l*36+Un.width/2+i*l/2:i*l*14-Un.width/2-i*l/2,y(Un),y(zn);break;case"start":y(qn=new A(i*l*25,c*l*25,i*l*8,c*l*4,"START"));break;case"over":y(new A(i*l*25,c*l*25,i*l*8,c*l*4,"OVER"))}}()}undo(){"white"!=Jn.onMove&&(Jn.undo(),this.draw())}reset(e="black",r=1,n){Jn.owner=e,this.#O=r,this.#N(e,n)}#N(e,r){this.#F.reset(),Jn.reset(e),r&&this.#_(r),this.#W(),"white"==e&&(this.#F.switchTurn(),setTimeout((()=>this.#H()),1500))}#_(e){let r=-e[0],n=e[25];Jn.barWhite=r,Jn.barBlack=n;for(let t=1;t<25;++t){const a=Jn[`p${t}`];e[t]>0?(n+=e[t],a[0]=e[t],a[1]=0):e[t]<0?(r+=-e[t],a[0]=-e[t],a[1]=1):(a[0]=a[1]=0,Jn[`p${t}`]=[0,0])}Jn.offBlack=15-n,Jn.offWhite=15-r}#R(e){const r=Math.min(e.width,e.height);this.#m.canvas.width=r,this.#m.canvas.height=3*r/4,this.#V(r)}#V(e){this.#B=e,console.debug("# ",this.#B,this.#T),this.draw()}#k(e,r){if("over"!=Jn.status){if(Gn=function(e,r,n){var t=e.getBoundingClientRect(),a=(e.width,e.height,0),o={x:r,y:n};return o.xp=parseFloat(o.x/t.width*50).toFixed(2),o.yp=parseFloat(o.y/t.height*50).toFixed(2),o.xp>27&&o.xp<45&&o.yp>2&&o.yp<22?a=Math.floor((o.xp-27)/3)+19:o.xp>5&&o.xp<23&&o.yp>2&&o.yp<22?a=Math.floor((o.xp-5)/3)+13:o.xp>5&&o.xp<23&&o.yp>28&&o.yp<48?a=12-Math.floor((o.xp-5)/3):o.xp>27&&o.xp<45&&o.yp>28&&o.yp<48&&(a=6-Math.floor((o.xp-27)/3)),0!=a?o.point="p"+a:o.xp>46&&o.xp<49&&o.yp>2&&o.yp<22?o.point="offWhite":o.xp>46&&o.xp<49&&o.yp>28&&o.yp<48?o.point="offBlack":Jn.barBlack[0]>0&&o.xp>23.5&&o.xp<26.5?o.point="barBlack":jn.onScreen&&o.x>jn.x-jn.width/2&&o.x<jn.x+jn.width/2&&o.y>jn.y-jn.height/2&&o.y<jn.y+jn.height/2?o.point="rollButton":qn.onScreen&&o.xp>21&&o.xp<29&&o.yp>23&&o.yp<27?o.point="startButton":Un.onScreen&&o.x>Un.x-Un.width/2&&o.x<Un.x+Un.width/2&&o.y>Un.y-Un.height/2&&o.y<Un.y+Un.height/2?o.point="takeButton":zn.onScreen&&o.x>zn.x-zn.width/2&&o.x<zn.x+zn.width/2&&o.y>zn.y-zn.height/2&&o.y<zn.y+zn.height/2?o.point="passButton":Yn.onScreen&&o.x>Yn.x-Yn.size/2&&o.x<Yn.x+Yn.size/2&&o.y>Yn.y-Yn.size/2&&o.y<Yn.y+Yn.size/2?o.point="Cube":Kn.onScreen?("right"==Kn.position&&o.xp>32.5&&o.xp<39.5&&o.yp>23&&o.yp<27&&(o.point="Dices"),"left"==Kn.position&&o.xp>10.5&&o.xp<17.5&&o.yp>23&&o.yp<27&&(o.point="Dices")):o.point=void 0,o}(this.canvas,e,r),Gn.point){if(Jn.mouseOverPoint="p"==Gn.point.charAt(0)?parseInt(Gn.point.substr(1)):void 0,"start"==Jn.status&&"startButton"==Gn.point){Jn.reset();for(var n=0,t=0;n==t;)n=Math.floor(6*Math.random())+1,t=Math.floor(6*Math.random())+1;Jn.onMove=n>t?"black":"white",Kn.diceValueLeft=Math.max(n,t),Kn.diceValueRight=Math.min(n,t),Jn.moves.push(n,t),Jn.moves.sort(),qn.onScreen=!1,Jn.status="move",this.draw()}if("roll"==Jn.status)if("rollButton"==Gn.point)this.#W();else if("Cube"==Gn.point){if("black"==Jn.onMove&&"white"==Yn.position)return;if("white"==Jn.onMove&&"black"==Yn.position)return;jn.onScreen=!1,Jn.onMove="black"==Jn.onMove?"white":"black",Yn.position="black"==Jn.onMove?"left":"right",Yn.value*=2,Jn.status="accept",this.draw()}if("move"==Jn.status){var a,o,s,i=new Xn;if("p"==Gn.point.charAt(0)||"b"==Gn.point.charAt(0)){if(Jn[Gn.point][1]!=("black"==Jn.onMove?0:1))return;if(0==Jn.moves.length)return;if(a=Gn.point,!i.hasOwnProperty(a)||0==i[a].length)return;o="p"==a.charAt(0)?Jn.mouseOverPoint:"black"==Jn.onMove?25:0;var c=i[a].length>1?Kn.diceValueLeft:i[a][0];if(s="black"==Jn.onMove?o-c:o+c,Qn(a,"black"==Jn.onMove&&s<1?"offBlack":"white"==Jn.onMove&&s>24?"offWhite":"p"+s),Jn.moves.splice(Jn.moves.indexOf(c),1),Jn.moves.length>0)if("black"==Jn.onMove&&15==Jn.offBlack[0]||"white"==Jn.onMove&&15==Jn.offWhite[0])this.#G();else{if("black"==Jn.onMove&&0==(new Xn).numOfValidMoves())return void this.#j();this.draw()}else this.#j()}else if("Dices"==Gn.point){if(i.numOfValidMoves()>0){var l=Kn.diceValueLeft;Kn.diceValueLeft=Kn.diceValueRight,Kn.diceValueRight=l,this.draw()}if(0==i.numOfValidMoves()){if(15==Jn["off"+Jn.onMove.capitalizeFirstLetter()][0])return Kn.onScreen=!1,Jn.status="start",void this.draw();console.log("BG: send a move",Jn.playedMoves),Kn.onScreen=!1,Jn.onMove="black"==Jn.onMove?"white":"black",Jn.status="roll",Jn.moves=[],Jn.playedMoves=[],this.draw()}}}"accept"==Jn.status&&("takeButton"==Gn.point?(Un.onScreen=!1,zn.onScreen=!1,Yn.position="black"==Jn.onMove?"black":"white",Jn.onMove="black"==Jn.onMove?"white":"black",Jn.status="roll",this.draw()):"passButton"==Gn.point&&(Un.onScreen=!1,zn.onScreen=!1,Jn.onMove,Jn.status="start",this.draw())),this.draw()}}else this.#P[0]<this.#O&&this.#P[1]<this.#O&&this.#N(Jn.onMove)}#W(){var e,r;Jn.moves=[],e=Math.floor(6*Math.random())+1,r=Math.floor(6*Math.random())+1,Kn.diceValueLeft=e,Kn.diceValueRight=r,r>e&&(Kn.diceValueLeft=r,Kn.diceValueRight=e),jn.onScreen=!1,Jn.moves.push(e,r),r==e&&Jn.moves.push(e,r),Jn.moves.sort(),Jn.status="move",console.debug("ROLL:",Jn.moves),this.draw();const n=(new Xn).numOfValidMoves();return 0==n&&("black"==Jn.onMove?setTimeout((()=>this.#j()),800):(this.#g.onmove({color:Jn.onMove,dices:[Kn.diceValueLeft,Kn.diceValueRight],moves:[]}),this.#F.switchTurn(),this.#U(),setTimeout((()=>this.#W()),1200))),n}#j(){console.debug("User move",Jn.playedMoves);const e=Jn.playedMoves.map((e=>{const[r,n]=e.split("/");let t,a;return r.startsWith("p")?t=parseInt(r.slice(1))-1:r.startsWith("b")&&(t=24),n.startsWith("p")?a=parseInt(n.slice(1))-1:n.startsWith("o")&&(a=-1),[t,a]}));if(this.#g.onmove({color:Jn.onMove,dices:[Kn.diceValueLeft,Kn.diceValueRight],moves:Jn.playedMoves}),15==Jn.offBlack[0])return console.debug("Game over. Black win"),void this.#G();this.#F.move(e),this.#U(),0!=this.#W()&&setTimeout((()=>this.#H()),1e3)}#H(){const e=[Kn.diceValueLeft,Kn.diceValueRight],r=this.#F.move(e,!0);if(r.length>0){let n,t;for(const e of r)n=24==e[0]?"barWhite":"p"+(24-e[0]),t=-1==e[1]?"offWhite":"p"+(24-e[1]),Qn(n,t);15==Jn.offWhite[0]?this.#G():(this.#g.onmove({color:Jn.onMove,dices:e,moves:Jn.playedMoves}),this.#U(),this.#W())}else console.debug("TODO: no valid moves"),this.#U(),this.#W()}#U(){Jn.moves=[],Jn.playedMoves=[],Jn.onMove="black"==Jn.onMove?"white":"black",console.debug("Change turn",Jn.onMove),this.#F.turn}#G(){let e,r,n=!1;"white"==Jn.onMove?(r=1,e=Jn.offBlack[0]>0?1:2):(r=0,e=Jn.offWhite[0]>0?1:2),this.#P[r]+=e,n=this.#P[r]==this.#O;const t={win:Jn.onMove,score:this.#P,total:this.#O,points:e,over:n};console.debug("Game over:",t),Jn.status="over",Yn.position,Kn.onScreen=!1,this.draw(),this.#g.onover(t)}}function Qn(e,r){console.debug("MOVE:",e,r),0==Jn.playedMoves.length&&Jn.save(),"o"==r.charAt(0)?Jn["off"+Jn.onMove.capitalizeFirstLetter()][0]++:0==Jn[r][0]?(Jn[r][0]++,Jn[r][1]=Jn[e][1]):Jn[r][1]==Jn[e][1]?Jn[r][0]++:(Jn[r][1]=1-Jn[r][1],"black"==Jn.onMove?Jn.barWhite[0]++:Jn.barBlack[0]++),0==--Jn[e][0]&&"p"==e.charAt(0)&&(Jn[e][1]=-1),Jn.playedMoves.push(e+"/"+r)}function Zn(e,r,n,t,a,o,s,i){if(void 0===i&&(i=!0),void 0===o&&(o=5),"number"==typeof o)o={tl:o,tr:o,br:o,bl:o};else{var c={tl:0,tr:0,br:0,bl:0};for(var l in c)o[l]=o[l]||c[l]}e.beginPath(),e.moveTo(r+o.tl,n),e.lineTo(r+t-o.tr,n),e.quadraticCurveTo(r+t,n,r+t,n+o.tr),e.lineTo(r+t,n+a-o.br),e.quadraticCurveTo(r+t,n+a,r+t-o.br,n+a),e.lineTo(r+o.bl,n+a),e.quadraticCurveTo(r,n+a,r,n+a-o.bl),e.lineTo(r,n+o.tl),e.quadraticCurveTo(r,n,r+o.tl,n),e.closePath(),s&&e.fill(),i&&e.stroke()}})(),t.default})()));